(function(a){var c=function(a,d){var f=d||{},e=f.bufferLen||4096;this.context=a.context;this.node=this.context.createScriptProcessor(e,2,2);var h=new Worker(f.workerPath||"js/workers/recorderWorker.js");h.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var c=!1,m;this.node.onaudioprocess=function(a){c&&h.postMessage({command:"record",buffer:[a.inputBuffer.getChannelData(0),a.inputBuffer.getChannelData(1)]})};this.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&
(f[b]=a[b])};this.record=function(){c=!0};this.stop=function(){c=!1};this.clear=function(){h.postMessage({command:"clear"})};this.getBuffers=function(a){m=a||f.callback;h.postMessage({command:"getBuffers"})};this.exportWAV=function(a,b){m=a||f.callback;b=b||f.type||"audio/wav";if(!m)throw Error("Callback not set");h.postMessage({command:"exportWAV",type:b})};h.onmessage=function(a){m(a.data)};a.connect(this.node);this.node.connect(this.context.destination);this.connectSource=void 0};c.forceDownload=
function(b,d){var f=(a.URL||a.webkitURL).createObjectURL(b),e=a.document.createElement("a");e.href=f;e.download=d||"output.wav";f=document.createEvent("Event");f.initEvent("click",!0,!0);e.dispatchEvent(f)};a.Recorder=c})(window);function doneEncoding(a){recIndex=0;Recorder.forceDownload(a,"myRecording"+(10>recIndex?"0":"")+recIndex+".wav");recIndex++};var Util=Util||{};Util.merge=function(a,c){var b={},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);for(d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b};Util.toArray=function(a){return Array.prototype.slice.call(a||[],0)};Util.stringify=function(a){var c=[],b;for(b in a)c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")};Util.unstringify=function(a){a=a.split("&");for(var c={},b=0,d;d=a[b];++b)d=d.split("="),c[decodeURIComponent(d[0])]=decodeURIComponent(d[1]);return c};
Util.formatDate=function(a){a=new Date(a.split("T")[0]);return[a.getMonth()+1,a.getDate(),a.getFullYear().toString().substring(2)].join("/")};Util.ISODateString=function(a){var c=function(a){return 10>a?"0"+a:a};return a.getUTCFullYear()+"-"+c(a.getUTCMonth()+1)+"-"+c(a.getUTCDate())+"T"+c(a.getUTCHours())+":"+c(a.getUTCMinutes())+":"+c(a.getUTCSeconds())};Util.format=function(a){var c=Array.prototype.slice.call(arguments,1);return a.replace(/\{(\d+)\}/g,function(a,d){return c[d]})};
Util.sortByDate=function(a,c){return a.updatedDateFull<c.updatedDateFull?1:a.updatedDateFull>c.updatedDateFull?-1:0};Util.sortByTitle=function(a,c){return a.title<c.title?1:a.title>c.title?-1:0};function getNthChild(a,c){var b=0,d;for(d in a)if(a.hasOwnProperty(d)){if(c==b)return d;b++}}Object.size=function(a){var c=0,b;for(b in a)a.hasOwnProperty(b)&&c++;return c};
function clone(a){if(null==a||"object"!=typeof a)return a;var c=a.constructor(),b;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c}function log(a){debug&&console.log(a)}function createUniqID(){return String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now()}Number.prototype.padLeft=function(a,c){var b=String(a||10).length-String(this).length+1;return 0<b?Array(b).join(c||"0")+this:this};
function dateFormat(){var a=new Date;return[a.getFullYear(),(a.getMonth()+1).padLeft(),a.getDate().padLeft()].join("-")+" "+[a.getHours().padLeft(),a.getMinutes().padLeft(),a.getSeconds().padLeft()].join(":")}function onError(a){debug&&console.log(a)}
(function(a){a.fn.pot=function(c){var b=a.extend({min:0,max:100,step:1,width:40,snap:0,val:0,id:null,offset:-125,angle:250,fgColor:"#EEE",bgColor:"#222",cursorColor:"#000",change:function(){},release:function(){}},c||{}),d=b.max-b.min,f=b.val,e=1/b.step,h='<div class="drawedPot" id="'+b.id+'Pot" width="'+b.width+'" height="'+b.width+'">            </div>',l=1,m=null;return this.each(function(){var c=a(this);f=parseFloat(c.val());c.before(h);c.css("width",b.width-10);c.addClass("customInput");var p=
document.createElement("canvas");div=document.getElementById(b.id+"Pot");p.id="CursorLayer";p.width=b.width;p.height=b.width;div.appendChild(p);var g=a("#"+b.id+"Pot");g.find(".top");var r=a(document),n=function(){var a=b.offset*Math.PI/180,e=1.5*Math.PI+a,h=1.5*Math.PI+a+b.angle*Math.PI/180;this.c=p.getContext("2d");this.c.clearRect(0,0,b.width,b.width);this.c.beginPath();this.c.strokeStyle=b.bgColor;this.c.lineWidth=6;this.c.arc(b.width/2,b.width/2,b.width/2-5,e,h,!1);this.c.stroke();0>b.min&&0<
b.max?(h=(f-b.min)/d,h*=b.angle,h=h*Math.PI/180,0>f?(e=1.5*Math.PI+a+h,a=1.5*Math.PI,h=e):(e=1.5*Math.PI,h=a=1.5*Math.PI+a+h)):(h=(f-b.min)/d,h*=b.angle,h=a=1.5*Math.PI+a+h*Math.PI/180);this.c.beginPath();this.c.strokeStyle=b.fgColor;this.c.lineWidth=6;this.c.arc(b.width/2,b.width/2,b.width/2-5,e,a,!1);this.c.stroke();this.c.beginPath();this.c.strokeStyle=b.cursorColor;this.c.lineWidth=10;this.c.arc(b.width/2,b.width/2,b.width/2-15,h-0.1,h,!1);this.c.stroke()},s=function(a){c.val(a);f=a;n();b.change(a)};
this.init=function(){n()};this.init();c.bind("configure",function(){f=parseFloat(c.val());n()});c.bind("keydown",function(h){var d=h.keyCode;if(13==d){var g=Math.round(c.val()*e)/e;if(g>=b.min&&g<=b.max){s(g);return}if(g>b.max){s(b.max);return}if(g<b.min){s(b.min);return}}96<=d&&105>=d&&(d=h.keyCode=d-48);kval=parseFloat(String.fromCharCode(d));isNaN(kval)&&-1<a.inArray(d,[38,40])&&(h.preventDefault(),h=1,40==d&&(h=-1),g=Math.round((f+h*l*b.step)*e)/e,g>=b.min&&g<=b.max&&s(g),m=window.setTimeout(function(){l*=
2},30))});c.bind("keyup",function(a){isNaN(kval)&&m&&(window.clearTimeout(m),m=null,l=1)});g.on("mousedown",function(a){a.preventDefault();var h=a.pageY;r.bind("mousemove.k",function(a){var d=h-a.pageY;2<Math.abs(d)&&(d*=4);h=a.pageY;a=Math.round((f+d*b.step)*e)/e;a>=b.min&&a<=b.max&&s(a)});r.bind("mouseup.k",function(a){r.unbind("mousemove.k mouseup.k keyup.k");b.release()})})})}})(jQuery);function tuner(a,c){var b=context.createBiquadFilter();b.type=b.LOWPASS;b.frequency.value=15E3;var d=context.createBiquadFilter();d.type=d.HIGHPASS;d.frequency.value=70;var f=new FFT(16384,context.sampleRate/4),e=context.createScriptProcessor(16384,1,1),h=[],l="C C# D D# E F F# G G# A A# B".split(" "),m=$("#tuner .note"),q=$("#tuner .cent").width(),p=$("#tuner #cursor"),g=null,r=function(){var a,b,e;a=null;f.forward(h);b=[];e=null;for(var d=1;400>d&&!(0.02<=f.spectrum[d]&&(!e&&d&&(e=d,b.push(d)),
e&&(f.spectrum[d]>f.spectrum[d-1]&&d<=b[b.length-1]+2?b[b.length-1]=d:d>b[b.length-1]+2&&(e=null)),2==b.length));d++);b.length&&(d=b[0],e=Math.log(f.spectrum[d-1]),b=Math.log(f.spectrum[d]),a=Math.log(f.spectrum[d+1]),a=(0.5*((e-a)/(e-2*b+a))+d)*(context.sampleRate/16384));a?(b=12*(Math.log(a/440)/Math.log(2)),b=Math.round(b)+69,m.text(l[Math.round(b%12)]),a-=440*Math.pow(2,(b-69)/12),b=Math.abs(440*Math.pow(2,(b+1*(a?0>a?-1:1:0)-69)/12)-440*Math.pow(2,(b-69)/12)),p.css("left",q/2+Math.floor(100*
(a/b))/2)):(m.text("-"),p.css("left",q/2))};this.start=function(){debug&&console.log("Tuner Started");e.onaudioprocess=function(a){h=a.inputBuffer.getChannelData(0)};a.connect(b);b.connect(d);d.connect(e);e.connect(context.destination);setTimeout(function(){g=setInterval(r,330)},1E3)};this.stop=function(){clearInterval(g)}}
function DrawSpectrum(a,c){var b=document.querySelector(a);b.setAttribute("width",210);b.setAttribute("height",100);var d=b.getContext("2d"),b=0,f=function(a,b){d.stroke();d.beginPath();d.moveTo(Math.round(2.1*a),0);d.lineTo(Math.round(2.1*a),100);d.strokeStyle=b;d.stroke()};f(14,"#ff0000");f(18.8,"#ff9900");f(25.09,"#f00599");f(33.5,"#005F90");d.beginPath();d.strokeStyle="#000000";for(d.moveTo(0,0);100>=b;){var f=Math.round(2.1*b),e=c[b]/4E-4;b++;d.lineTo(f,e)}d.stroke()}
function FFT(a,c){FourierTransform.call(this,a,c);this.reverseTable=new Uint32Array(a);for(var b=1,d=a>>1,f;b<a;){for(f=0;f<b;f++)this.reverseTable[f+b]=this.reverseTable[f]+d;b<<=1;d>>=1}this.sinTable=new Float32Array(a);this.cosTable=new Float32Array(a);for(f=0;f<a;f++)this.sinTable[f]=Math.sin(-Math.PI/f),this.cosTable[f]=Math.cos(-Math.PI/f)}
FFT.prototype.forward=function(a){var c=this.bufferSize,b=this.cosTable,d=this.sinTable,f=this.reverseTable,e=this.real,h=this.imag,l=Math.floor(Math.log(c)/Math.LN2);if(Math.pow(2,l)!==c)throw"Invalid buffer size, must be a power of 2.";if(c!==a.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+c+" Buffer Size: "+a.length;var l=1,m,q,p,g,r,n;for(n=0;n<c;n++)e[n]=a[f[n]],h[n]=0;for(;l<c;){a=b[l];f=d[l];m=1;for(var s=q=0;s<l;s++){for(n=s;n<c;)p=n+l,g=m*e[p]-q*h[p],r=m*h[p]+
q*e[p],e[p]=e[n]-g,h[p]=h[n]-r,e[n]+=g,h[n]+=r,n+=l<<1;n=m;m=n*a-q*f;q=n*f+q*a}l<<=1}return this.calculateSpectrum()};
function FourierTransform(a,c){this.bufferSize=a;this.sampleRate=c;this.bandwidth=2/a*c/2;this.spectrum=new Float32Array(a/2);this.real=new Float32Array(a);this.imag=new Float32Array(a);this.peak=this.peakBand=0;this.getBandFrequency=function(a){return this.bandwidth*a+this.bandwidth/2};this.calculateSpectrum=function(){for(var b=this.spectrum,d=this.real,f=this.imag,e=2/this.bufferSize,h=Math.sqrt,c,m,q=0,p=a/2;q<p;q++)c=d[q],m=f[q],c=e*h(c*c+m*m),c>this.peak&&(this.peakBand=q,this.peak=c),b[q]=
c}}
FFT.prototype.inverse=function(a,c){var b=this.bufferSize,d=this.cosTable,f=this.sinTable,e=this.reverseTable;a=a||this.real;c=c||this.imag;var h=1,l,m,q,p,g,r,n;for(n=0;n<b;n++)c[n]*=-1;l=new Float32Array(b);m=new Float32Array(b);for(n=0;n<a.length;n++)l[n]=a[e[n]],m[n]=c[e[n]];a=l;for(c=m;h<b;){e=d[h];l=f[h];m=1;for(var s=q=0;s<h;s++){for(n=s;n<b;)p=n+h,g=m*a[p]-q*c[p],r=m*c[p]+q*a[p],a[p]=a[n]-g,c[p]=c[n]-r,a[n]+=g,c[n]+=r,n+=h<<1;n=m;m=n*e-q*l;q=n*l+q*e}h<<=1}d=new Float32Array(b);for(n=0;n<b;n++)d[n]=
a[n]/b;return d};var defaults={presetempty:{id:"defaultpreset",name:"Default Preset",devices:{inputScard:{input:[],output:["RightMiddle"],deletable:!1,connections:[],position:{top:100,left:50},pots:{},id:"inputScard",name:"Input"},outputScard:{input:["LeftMiddle"],output:[],deletable:!1,connections:[],position:{top:100,left:750},pots:{},id:"outputScard",name:"Output"}}},preset:{id:"defaultpreset",name:"Default Preset",devices:{inputScard:{input:[],output:["RightMiddle"],deletable:!1,connections:["Overdrive346"],position:{top:170,
left:70},pots:{},id:"inputScard",name:"Input"},outputScard:{input:["LeftMiddle"],output:[],deletable:!1,connections:[],position:{top:150,left:660},pots:{},id:"outputScard",name:"Output"},Overdrive346:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Amp75"],position:{top:120,left:220},pots:{gain:{name:"Gain",id:"gain",midi:!0,val:3.97},tone:{name:"Tone",id:"tone",val:6012},volume:{name:"Volume",id:"volume",val:1}},selects:{type:{name:"Type",id:"type",selected:"Guitar1"}},switchers:{bypass:{name:"Bypass",
id:"bypass",midi:!0,val:!1}},name:"Overdrive",id:"Overdrive346"},Amp75:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Cabinet7486"],position:{top:180,left:370},pots:{drive:{name:"Drive",id:"drive",midi:!0,val:5.07},bass:{name:"Bass",id:"bass",val:6.67},mid:{name:"Mid",id:"mid",val:5},treb:{name:"Treb",id:"treb",val:5.8},presence:{name:"Presence",id:"presence",val:6.66},master:{name:"Master",id:"master",val:8.83}},switchers:{boost:{name:"Boost",id:"boost",val:!0},bypass:{name:"Bypass",
id:"bypass",midi:!0,val:!1}},selects:{type:{name:"Type",id:"type",selected:"Amp1"}},name:"Amp",id:"Amp75"},Cabinet7486:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["outputScard"],position:{top:110,left:510},tabs:["General"],pots:{volume:{name:"Volume",id:"volume",val:1}},selects:{type:{name:"Type",id:"type",selected:"Guitar2"}},switchers:{bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},defaultscabs:{Guitar1:{id:"Guitar1",name:"Vintage"},Guitar2:{id:"Guitar2",name:"Modern"}},
name:"Cabinet",id:"Cabinet7486"}}},factory:{preset1:{id:"preset1",name:"Brit Rock",devices:{inputScard:{input:[],output:["RightMiddle"],deletable:!1,connections:["Overdrive346"],position:{top:180,left:60},pots:{},id:"inputScard",name:"Input"},outputScard:{input:["LeftMiddle"],output:[],deletable:!1,connections:[],position:{top:170,left:640},pots:{},id:"outputScard",name:"Output"},Overdrive346:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Amp75"],position:{top:140,left:230},
pots:{gain:{name:"Gain",id:"gain",midi:!0,val:6.2},tone:{name:"Tone",id:"tone",val:9993},volume:{name:"Volume",id:"volume",val:0.65}},selects:{type:{name:"Type",id:"type",selected:"Guitar1"}},switchers:{bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},name:"Overdrive",id:"Overdrive346"},Amp75:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Cabinet7486"],position:{top:170,left:340},pots:{drive:{name:"Drive",id:"drive",midi:!0,val:5.74},bass:{name:"Bass",id:"bass",val:3.24},
mid:{name:"Mid",id:"mid",val:5.14},treb:{name:"Treb",id:"treb",val:5.23},presence:{name:"Presence",id:"presence",val:5.48},master:{name:"Master",id:"master",val:5.42}},switchers:{boost:{name:"Boost",id:"boost",val:!0},bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},selects:{type:{name:"Type",id:"type",selected:"Amp5"}},name:"Amp",id:"Amp75"},Cabinet7486:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["outputScard"],position:{top:100,left:490},tabs:["General"],pots:{volume:{name:"Volume",
id:"volume",val:1}},selects:{type:{name:"Type",id:"type",selected:"Guitar1"}},switchers:{bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},defaultscabs:{Guitar1:{id:"Guitar1",name:"Vintage"},Guitar2:{id:"Guitar2",name:"Modern"}},name:"Cabinet",id:"Cabinet7486"}}},preset2:{id:"preset2",name:"Rock Hall",devices:{inputScard:{input:[],output:["RightMiddle"],deletable:!1,connections:["Amp75"],position:{top:190,left:60},pots:{},id:"inputScard",name:"Input"},outputScard:{input:["LeftMiddle"],output:[],
deletable:!1,connections:[],position:{top:170,left:640},pots:{},id:"outputScard",name:"Output"},Amp75:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Cabinet7486"],position:{top:170,left:190},pots:{drive:{name:"Drive",id:"drive",midi:!0,val:7.52},bass:{name:"Bass",id:"bass",val:5.57},mid:{name:"Mid",id:"mid",val:5.14},treb:{name:"Treb",id:"treb",val:6.81},presence:{name:"Presence",id:"presence",val:5},master:{name:"Master",id:"master",val:3.84}},switchers:{boost:{name:"Boost",
id:"boost",val:!0},bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},selects:{type:{name:"Type",id:"type",selected:"Amp5"}},name:"Amp",id:"Amp75"},Cabinet7486:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Delay4415"],position:{top:160,left:320},tabs:["General"],pots:{volume:{name:"Volume",id:"volume",val:0.53}},selects:{type:{name:"Type",id:"type",selected:"Guitar1"}},switchers:{bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},defaultscabs:{Guitar1:{id:"Guitar1",name:"Vintage"},
Guitar2:{id:"Guitar2",name:"Modern"}},name:"Cabinet",id:"Cabinet7486"},Reverb2481:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["outputScard"],position:{top:150,left:540},pots:{volume:{name:"Volume",id:"volume",val:0.67},mix:{name:"Mix",id:"mix",val:33.1}},switchers:{bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},name:"Reverb",id:"Reverb2481"},Delay4415:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Reverb2481"],position:{top:145,left:455},pots:{time:{name:"Time",
id:"time",val:311},mix:{name:"Mix",id:"mix",val:51},feedback:{name:"Feedback",id:"feedback",val:88}},switchers:{bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},name:"Delay",id:"Delay4415"}}},preset3:{id:"preset3",name:"Octaver Down",devices:{inputScard:{input:[],output:["RightMiddle"],deletable:!1,connections:["Pitch1396"],position:{top:190,left:60},pots:{},id:"inputScard",name:"Input"},outputScard:{input:["LeftMiddle"],output:[],deletable:!1,connections:[],position:{top:170,left:640},pots:{},
id:"outputScard",name:"Output"},Amp75:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Cabinet7486"],position:{top:160,left:330},pots:{drive:{name:"Drive",id:"drive",midi:!0,val:8.52},bass:{name:"Bass",id:"bass",val:4.17},mid:{name:"Mid",id:"mid",val:5.14},treb:{name:"Treb",id:"treb",val:6.81},presence:{name:"Presence",id:"presence",val:5},master:{name:"Master",id:"master",val:3.84}},switchers:{boost:{name:"Boost",id:"boost",val:!0},bypass:{name:"Bypass",id:"bypass",midi:!0,
val:!1}},selects:{type:{name:"Type",id:"type",selected:"Amp5"}},name:"Amp",id:"Amp75"},Cabinet7486:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["outputScard"],position:{top:160,left:480},tabs:["General"],pots:{volume:{name:"Volume",id:"volume",val:0.53}},selects:{type:{name:"Type",id:"type",selected:"Guitar1"}},switchers:{bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},defaultscabs:{Guitar1:{id:"Guitar1",name:"Vintage"},Guitar2:{id:"Guitar2",name:"Modern"}},name:"Cabinet",
id:"Cabinet7486"},Pitch1396:{input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,connections:["Amp75"],position:{top:170,left:210},pots:{gain:{name:"Gain",id:"gain",midi:!0,val:0.9},pitch:{name:"Pitch",id:"pitch",val:100,midi:!0}},selects:{type:{name:"Type",id:"type",selected:"whammy"},mode:{name:"Mode",id:"mode",selected:"1DOWN"}},switchers:{bypass:{name:"Bypass",id:"bypass",midi:!0,val:!1}},name:"Pitch",id:"Pitch1396"}}}},newPreset:{id:"newpreset",name:"New Preset",devices:{inputScard:{input:[],
output:["RightMiddle"],deletable:!1,connections:[],position:{top:100,left:50},pots:{},id:"inputScard",name:"Input"},outputScard:{input:["LeftMiddle"],output:[],deletable:!1,connections:[],position:{top:100,left:750},pots:{},id:"outputScard",name:"Output"}}},devices:"Gain Reverb Chorus Cabinet Overdrive Delay Amp Filter Gate Wah GraphicEQ Pitch".split(" "),dvpresets:{},sets:{},cabslist:{},miditable:{},settings:{mainInput:{name:"mainInput",id:"mainInput",val:0.8,min:0,max:1,step:0.01},mainOutput:{name:"mainOutput",
id:"mainOutput",val:0.8,min:0,max:1,step:0.01},mainGate:{name:"mainGate",id:"mainGate",val:-30,min:-100,max:0,step:1},lastOpened:0,activeSetId:2,tuner:{enabled:!1,mute:!0},installDir:null}};var server="",debug=!1,version="0.7.5",liveInput,mainInput,tunerMute,mic,Buffer={},firstTimePlay=!0,Nodes={},audioBuffer=null,audioRecorder=null,presetInit=!0,presetModified=!1,filesLoaded=0,numberOfFiles=0,buffers=[],cabBuffers=[],cabsRoom=[],cabsList=[],playerBuffers=[],playerBlob=null,playerStartTime=0,playerStartOffset=0,playerIsPlaying=!1,playerLength=0,lvIn=null,lvOut=null,playerMeter=null,tune=null,context=null;try{context=new webkitAudioContext}catch(e$$21){}
var audioSource=context.createBufferSource(),time=context.currentTime,outputMix=context.createGain(),nullMix=context.createGain();nullMix.gain.value=0;outputMix.connect(context.destination);mic=null;
function audioInput(a){debug&&console.log("(stream)");mic=context.createMediaStreamSource(a);mainInput=context.createGain();tunerMute=context.createGain();mainInput.gain.value=1;tunerMute.gain.value=1;mic.connect(mainInput);mainInput.connect(tunerMute);a=context.createChannelSplitter(2);var c=context.createChannelMerger(2);tunerMute.connect(a);a.connect(c,0,0);a.connect(c,0,1);liveInput=c;(new mainLevelView(mainInput,"#inMeter")).start();(new mainLevelView(outputMix,"#outMeter")).start()}
navigator.webkitGetUserMedia({audio:!0,video:!1},audioInput,onError);
function mainLevelView(a,c){function b(){var a=null,e=null;d.getByteFrequencyData(f);for(e=0;e<f.length;e++)a+=f[e];e=a/f.length;a=-1*l/100*e;h.clearRect(0,0,m,l);h.fillRect(0,l,m,a);q=window.webkitRequestAnimationFrame(b)}var d=context.createAnalyser();d.fftSize=32;a.connect(d);var f=new Uint8Array(16),e=document.querySelector(c),h=e.getContext("2d"),l=e.height,m=e.width;h.fillStyle="#0f0";var q=null;this.start=function(){b()};this.stop=function(){setTimeout(function(){window.webkitCancelAnimationFrame(q);
q=!1;h.fillStyle="#0f0"},500)}}
var addTodevicesChain=function(a){var c=$("#PresetCtrl").scope().preset.devices;switch(a.name){case "Gain":var b=createGain;break;case "Input":b=createInput;break;case "Output":b=createOutput;break;case "Reverb":b=createReverb;break;case "Chorus":b=createChorus;break;case "Amp":b=createAmp;break;case "Overdrive":b=createOverdrive;break;case "Cabinet":b=createCabinet;break;case "Delay":b=createDelay;break;case "Filter":b=createFilter;break;case "Gate":b=createGate;break;case "Wah":b=createWah;break;
case "GraphicEQ":b=createGraphicEQ;break;case "Pitch":b=createPitch}c[a.id]=new b(a)},connectAll=function(){var a=$("#PresetCtrl").scope().preset.devices,c;for(c in a)if(a.hasOwnProperty(c)&&Nodes.hasOwnProperty(c))for(var b=Nodes[c].output,d=0;d<a[c].connections.length;d++){var f=a[c].connections[d];Nodes.hasOwnProperty(f)&&b.connect(Nodes[f].input)}a.hasOwnProperty("outputScard")&&Nodes.outputScard.output.connect(outputMix);a.hasOwnProperty("inputScard")&&(void 0!==audioSource&&audioSource.connect(Nodes.inputScard.input),
void 0!==liveInput&&liveInput.connect(Nodes.inputScard.input));audioRecorder?void 0!==liveInput&&liveInput.connect(audioRecorder.node):(debug&&console.log("(createRecorder)"),audioRecorder=new Recorder(liveInput));null!=tune?tune.stop():tune=new tuner(mainInput);angular.element("#PresetCtrl").scope().settings.tuner.enable&&tune.start()};
function modifydevicesChainConnections(a,c){var b,d,f=$("#PresetCtrl").scope().preset.devices;b=null==c.source.data("id")?c.sourceId:c.source.data("id");d=null==c.target.data("id")?c.targetId:c.target.data("id");switch(a){case "add":$("#PresetCtrl").scope().preset.devices[b].connections.push(d);$("#PresetCtrl").scope().modified=!0;break;case "del":var e=f[b].connections;e.length&&-1!=e.indexOf(d)&&f[b].connections.splice(e.indexOf(d),1);Nodes[b].output.disconnect();$("#PresetCtrl").scope().modified=
!0}setTimeout(function(){connectAll()},300)}function initPlay(){var a=context.createBufferSource();audioSource=null;a.buffer=Buffer;audioSource=a}var globalI=0,app=angular.module("guitarfx",["FSServices"]);
app.run(["$rootScope",function(a){a.defaults=angular.copy(defaults);a.sets=angular.copy(defaults.sets);a.dvpresets=angular.copy(defaults.dvpresets);a.settings=angular.copy(defaults.settings);a.cabslist=angular.copy(defaults.cabslist)}]).filter("startFrom",function(){return function(a,c){if("undefined"!=typeof a)return a.slice(+c)}}).directive("ngStopedit",function(){return{link:function(a,c,b){c.bind("keypress",function(d){13===d.charCode&&a.$apply(b.ngStopedit)});c.bind("keyup",function(d){27==d.keyCode&&
a.$apply(b.ngStopedit)});c.bind("blur",function(){a.$apply(b.ngStopedit)})}}}).directive("pedit",function(){return{link:function(a,c,b){c.bind("keypress",function(d){13===d.charCode&&(a.$parent.p.tmppresetname!=a.$parent.p.name?a.$apply(b.ngStopedit):(delete a.$parent.p.edit,a.$apply(b.ngModel)))});c.bind("keyup",function(d){27==d.keyCode&&(a.$parent.p.tmppresetname&&(a.$parent.p.name=angular.copy(a.$parent.p.tmppresetname),delete a.$parent.p.tmppresetname),delete a.$parent.p.edit,a.$apply(b.ngModel))});
c.bind("blur",function(d){a.$parent.p.tmppresetname!=a.$parent.p.name?a.$apply(b.ngStopedit):(delete a.$parent.p.edit,a.$apply(b.ngModel))})}}}).directive("dvpedit",function(){return function(a,c,b){c.bind("keypress",function(d){13===d.charCode&&(a.$parent.dvp.tmppresetname!=a.$parent.dvp.presetname?a.$apply(b.ngStopedit):(delete a.$parent.dvp.edit,a.$apply(b.ngModel)))});c.bind("keyup",function(d){27==d.keyCode&&(a.$parent.dvp.tmppresetname&&(a.$parent.dvp.presetname=angular.copy(a.$parent.dvp.tmppresetname),
delete a.$parent.dvp.tmppresetname),delete a.$parent.dvp.edit,a.$apply(b.ngModel))});c.bind("blur",function(){a.$parent.dvp.tmppresetname!=a.$parent.dvp.presetname?a.$apply(b.ngStopedit):(delete a.$parent.dvp.edit,a.$apply(b.ngModel))})}}).directive("setedit",function(){return function(a,c,b){c.bind("keypress",function(d){13===d.charCode&&a.$apply(b.ngStopsetedit)});c.bind("keyup",function(d){27==d.keyCode&&(a.$parent.set.tmpname&&(a.$parent.set.name=angular.copy(a.$parent.set.tmpname),delete a.$parent.set.tmpname),
delete a.$parent.set.edit,a.$apply(b.ngModel))});c.bind("blur",function(){a.$parent.set.tmpname==a.$parent.set.name&&(delete a.$parent.set.edit,a.$apply(b.ngModel))})}}).directive("draggable",function(){return{restrict:"A",link:function(a,c,b){a.$watch("activePreset",function(b){globalI++;b=$(c)["0"];c.css("top",a.block.position.top).css("left",a.block.position.left);jsPlumbDemos._addEndpoints(b,a.block.output,a.block.input,a.block.id);jsPlumb.draggable(b,{grid:[10,10],containment:$("#grid"),stop:function(b,
f){a.block.position=f.position;a.$parent.$apply(function(){a.$parent.modified=!0})}});b=a.preset.devices;if(presetInit&&globalI==Object.size(b)){for(var f in b)if(b.hasOwnProperty(f))for(var e=b[f].id+"_output",h=0;h<b[f].connections.length;h++)jsPlumb.connect({uuids:[e,b[f].connections[h]+"_input"]});presetInit=!1}})}}}).directive("mainpot",function(){return{link:function(a,c,b){var d=c.attr("id");c.val(a.defaults.settings[d].val).pot({change:function(b){a.preset.devices.inputScard.node.params[d](b);
a.settings[d].val=angular.copy(b)},release:function(b){a.$broadcast("UpdatePrefs")},min:a.defaults.settings[d].min,max:a.defaults.settings[d].max,width:38,id:d,step:a.defaults.settings[d].step,fgColor:"#555",bgColor:"#999",cursorColor:"#EEE"})}}}).directive("maingatenotused",function(){return{link:function(a,c,b){c.val(a.defaults.settings.mainGate.val).pot({change:function(b){a.preset.devices.inputScard.node.params.gate(b);a.settings.mainGate.val=angular.copy(b)},release:function(b){a.$broadcast("UpdatePrefs")},
min:a.defaults.settings.mainGate.min,max:a.defaults.settings.mainGate.max,width:38,id:"mainGate",step:a.defaults.settings.mainGate.step,fgColor:"#555",bgColor:"#999"})}}}).directive("pot",function(){return{link:function(a,c,b){a.$watch("pot.val",function(b){c.hasClass("customInput")&&c.val(a.pot.val).trigger("configure")});c.val(a.pot.val).pot({min:a.pot.min,max:a.pot.max,width:50,step:a.pot.step,id:a.pot.id,fgColor:"#222",bgColor:"#EEE",change:function(b){a.device.node.params[a.pot.id](b);a.pot.val=
b;a.$parent.modified=!0;a.$parent.$apply(function(){})}})}}}).directive("select",function(){return{link:function(a,c,b){a.device.node.params[a.select.id](a.select.selected);c.change(function(b){a.select.selected=b.target.selectedOptions[0].id;a.device.node.params[a.select.id](b.target.selectedOptions[0].id);a.$parent.modified=!0;a.$parent.$apply(function(){})})}}}).directive("switcher",function(){return{link:function(a,c,b){c.change(function(b){a.switcher.val=b.target.checked;a.device.node.params[a.switcher.id](b.target.checked);
a.$parent.modified=!0;a.$parent.$apply(function(){})})}}}).directive("droppable",function(){return function(a,c){c.bind("dragover",function(){c.addClass("drag")});c.bind("dragleave, drop",function(){c.removeClass("drag")})}});
(function(){window.jsPlumbDemos={init:function(){jsPlumb.importDefaults({DragOptions:{cursor:"pointer",zIndex:2E3},ConnectionOverlays:[["Arrow",{location:0.9}]],ConnectorZIndex:5});var a={lineWidth:5,strokeStyle:"#f5e756"},c={endpoint:"Dot",paintStyle:{fillStyle:"#225588",radius:7},isSource:!0,connector:["Bezier",{curviness:35}],maxConnections:20,connectorStyle:{lineWidth:4,strokeStyle:"#444",joinstyle:"round"},hoverPaintStyle:a,connectorHoverStyle:a,dragOptions:{scope:"effect"},overlays:[]},b={endpoint:"Dot",
paintStyle:{fillStyle:"#558822",radius:7},hoverPaintStyle:a,maxConnections:-1,dropOptions:{hoverClass:"hover",activeClass:"active",scope:"effect"},isTarget:!0,overlays:[]},d=[],f=[];this._addEndpoints=function(a,h,l,m){for(var q=0;q<h.length;q++)d.push(jsPlumb.addEndpoint(a,c,{anchor:h[q],uuid:m+"_output"}));for(h=0;h<l.length;h++)f.push(jsPlumb.addEndpoint(a,b,{anchor:l[h],uuid:m+"_input"}))};jsPlumb.bind("jsPlumbConnection",function(a,b){});jsPlumb.bind("click",function(a,b){$("#modalPlumb").modal("show");
$("#modalPlumb #valid").click(function(){jsPlumb.detach(a);$("#modalPlumb").modal("hide")});$(document).keypress(function(b){13==b.which&&(jsPlumb.detach(a),$("#modalPlumb").modal("hide"))})});jsPlumb.bind("jsPlumbConnection",function(a){presetInit||modifydevicesChainConnections("add",a)});jsPlumb.bind("jsPlumbConnectionDetached",function(a){presetInit||modifydevicesChainConnections("del",a)})}}})();jsPlumb.bind("ready",function(){jsPlumbDemos.init()});
$(function(){function a(a){debug&&console.log("MIDI ready!");b=a;angular.element("#PresetCtrl").scope().midi=!0;d=b.inputs();for(a=0;a<d.length;a++)d[a].onmidimessage=angular.element("#PresetCtrl").scope().handleMIDIMessage}function c(){angular.element("#PresetCtrl").scope().midi=!1;debug&&console.log("Failed to get MIDI access");$("#MidiDialog .modal-header h3").html("Midi not enabled");$("#MidiDialog .modal-message").html("<p>Go to <b><i>chrome://flags/#enable-web-midi</i></b> to enable midi.</p><p>Then restart Chrome or your Chromebook</p>")}
$("#PresetsDialog").modal({show:!1,keyboard:!1});$("#PresetsDialog").on("show",function(){debug||tracker.sendAppView("PresetsView")});$("#PresetsDialog").on("hidden",function(){$("#PresetCtrl").scope().saveSets()});$("#IRsModal").on("show",function(){debug||tracker.sendAppView("IRsView")});$("#IRsModal").on("hidden",function(){$("#PresetCtrl").scope().saveCabslist()});$("#PlayerModal").on("hidden",function(){angular.element("#PresetCtrl").scope().$apply(function(){angular.element("#PresetCtrl").scope().updloadInfo=
null})});$("#MidiDialog").on("show",function(){debug||tracker.sendAppView("MidiView")});$("#MidiDialog").on("hidden",function(){$("#PresetCtrl").scope().saveMidi()});$(".modal-body").scroll(function(){0<$(this).scrollTop()?$(".modal-sub-header").addClass("floating"):$(".modal-sub-header").removeClass("floating")});$(".nav.nav-list").scroll(function(){0<$(this).scrollTop()?$(".select-set").addClass("floating"):$(".select-set").removeClass("floating")});$("#allclist").sortable({stop:function(a,b){$(angular.element("#allclist li")).each(function(a,
b){$(b).find(".cabnb").html("Cab"+(a+1))});$("#PresetCtrl").scope().cabslistModified=!0}});$("#allplist").sortable({connectWith:"#plist"}).disableSelection();$("#plist").sortable({stop:function(a,b){angular.element("#PresetCtrl").scope().updateSet()},receive:function(a,b){var f=angular.element("#PresetCtrl").scope().sets;angular.element("#PresetCtrl").scope();var c=!1;if("undefined"===typeof angular.element("#PresetCtrl").scope().setview){for(var d in f){f.hasOwnProperty(d)&&angular.element("#PresetCtrl").scope().viewSet(d);
c=!0;break}c||angular.element("#PresetCtrl").scope().addSet()}angular.element("#PresetCtrl").scope().$apply(angular.element("#PresetCtrl").scope().updateSet())}});var b=null,d=null;try{navigator.requestMIDIAccess().then(a,c)}catch(f){}});var service=analytics.getService("guitarfx"),tracker=service.getTracker("UA-44027732-1");debug||tracker.sendAppView("MainView");var state=document.getElementById("network-state");state.innerHTML=navigator.onLine?"Online":"Offline";
window.addEventListener("online",function(){state.innerHTML="Online"},!1);window.addEventListener("offline",function(){state.innerHTML="Offline"},!1);
document.addEventListener("keydown",function(a){0===navigator.platform.indexOf("Mac")?(a.metaKey&&(!a.shiftKey&&"N"===String.fromCharCode(a.keyCode))&&(angular.element("#PresetCtrl").scope().newPreset(),angular.element("#PresetCtrl").scope().$apply(),a.preventDefault(),a.stopPropagation()),a.metaKey&&(!a.shiftKey&&"S"===String.fromCharCode(a.keyCode))&&(angular.element("#PresetCtrl").scope().savePreset(!1),a.preventDefault(),a.stopPropagation()),a.metaKey&&(a.shiftKey&&"S"===String.fromCharCode(a.keyCode))&&
(angular.element("#PresetCtrl").scope().savePreset(!0),a.preventDefault(),a.stopPropagation())):(a.ctrlKey&&(!a.shiftKey&&"N"===String.fromCharCode(a.keyCode))&&(angular.element("#PresetCtrl").scope().newPreset(),a.preventDefault(),a.stopPropagation()),a.ctrlKey&&(!a.shiftKey&&"S"===String.fromCharCode(a.keyCode))&&(angular.element("#PresetCtrl").scope().savePreset(!1),a.preventDefault(),a.stopPropagation()),a.ctrlKey&&(a.shiftKey&&"S"===String.fromCharCode(a.keyCode))&&(angular.element("#PresetCtrl").scope().savePreset(!0),
a.preventDefault(),a.stopPropagation()))},!0);var accessToken=null,fileSystem=null,prefs={},cache={},PREFSFILE="prefs.json",CACHEFILE=".cache",CABSFOLDER="Cab-IRs",REVFOLDER="Rev-IRs",PLFOLDER="Player",presetsList={},pro=!1;
angular.module("FSServices",[]).factory("FS",["$rootScope",function(a){var c={},b=chrome&&chrome.fileSystem,d=chrome&&chrome.storage.sync;c.init=function(){b||d?(chrome.storage.sync.get("pro",function(a){a.pro&&(pro=!0)}),chrome.storage.sync.get("installDir",function(a){null==a.installDir?(chrome.syncFileSystem.requestFileSystem(function(a){a.root.getFile(PREFSFILE,{create:!1},function(a){setTimeout(function(){$("#infosModal .modal-body").append("<br><br><p style='font-size:.8em;'>If you have already created some presets : <br>GuitarFX use a new FileSystem. Your saved presets won't be delete, you can find them in your Google Drive by searching <i>Chrome Syncable Filesystem Dev</i>. If you need support, more informations here : <a href='https://plus.google.com/communities/102489901490134079342'>Google +</a></p>")},
1E3)})}),$("#infosModal").modal("show"),$("#infosModal .modal-header h3").html("Choose a directory for intallation."),$("#infosModal .modal-body").html('<p style="text-align:center;"><button id="chooseDir">Choose directory</button></p>'),$("#infosModal").modal("show"),c.declareFsError("No installation directory.",!1),$("#infosModal .modal-body #chooseDir").click(function(){chrome.fileSystem.chooseEntry({type:"openDirectory"},function(a){a?($("#infosModal").modal("hide"),c.onFileSystemOpened(a),angular.element("#PresetCtrl").scope().settings.installDir=
chrome.fileSystem.retainEntry(a),chrome.storage.sync.set({installDir:chrome.fileSystem.retainEntry(a)})):console.log("No directory selected.")})})):chrome.fileSystem.restoreEntry(a.installDir,function(a){if(a)c.onFileSystemOpened(a);else $("#infosModal").modal("show"),$("#infosModal .modal-header h3").html("Unable to find GuitarFX directory."),$("#infosModal .modal-body").html('<p style="text-align:center;">Please choose a new directory</br></br><button id="chooseDir">Choose directory</button></p>'),
$("#infosModal").modal("show"),c.declareFsError("No installation directory",!1),$("#infosModal .modal-body #chooseDir").click(function(){chrome.fileSystem.chooseEntry({type:"openDirectory"},function(a){a?($("#infosModal").modal("hide"),c.onFileSystemOpened(a),angular.element("#PresetCtrl").scope().settings.installDir=chrome.fileSystem.retainEntry(a),chrome.storage.sync.set({installDir:chrome.fileSystem.retainEntry(a)})):console.log("No directory selected.")})})})})):c.declareFsError("No FileSystem support",
!0)};c.declareFsError=function(b,e){debug&&console.log(b);a.sets=defaults.sets;a.dvpresets=defaults.dvpresets;a.settings=defaults.settings;a.cabslist={};a.miditable=defaults.cabslist;a.mainerror='<span style="color:#FF2424;">'+b+"</span>";e&&a.$broadcast("FileSystemReady")};c.openSyncableFileSystem=function(){function a(b){h+=500;fileSystem||(!fileSystem&&h<=d?setTimeout(a,500,b):b())}chrome.syncFileSystem.requestFileSystem(function(a){if(chrome.runtime.lastError)error("requestFileSystem: "+chrome.runtime.lastError.message);
else c.onFileSystemOpened(a)});var b=Math.round((new Date).getTime()/1E3),h=b,d=b+1E4;a(c.declareFsError,"FileSystem TimeOut outchh...",!1)};c.onFileSystemOpened=function(b){fileSystem=b;a.mainerror=null;fileSystem.createReader().readEntries(function(a){for(var b=a.length-1;0<=b;b--)if(a[b].name==PREFSFILE&&a[b].isFile){c.doPrefs();return}c.installPrefs()},onError)};c.doPrefs=function(){debug&&console.log("doPrefs");fileSystem.getFile(PREFSFILE,{create:!1},function(a){c.initPrefs(c.doCache)},c.installPrefs)};
c.installPrefs=function(){if(fileSystem){debug&&console.log("First Install Prefs...");a.$broadcast("PrefsReady");var b=c.doCache;chrome.fileSystem.getDisplayPath(fileSystem,function(e){defaults.settings.installDir=e;a.settings.installDir=e;fileSystem.getFile(PREFSFILE,{create:!0},function(a){a.createWriter(function(a){var h=new Blob([JSON.stringify({sets:defaults.sets,dvpresets:defaults.dvpresets,settings:defaults.settings,cabslist:defaults.cabslist})],{type:"application/json"});a.onwriteend=function(a){b()};
a.onerror=function(a){b();debug&&console.log(a)};a.write(h)})},onError)})}};c.initPrefs=function(b){debug&&console.log("(Init Prefs)");fileSystem.getFile(PREFSFILE,{create:!1},function(e){e.file(function(h){var e=new FileReader;e.onloadend=function(h){if(this.result.length)try{var e=angular.fromJson(this.result);debug&&console.log(e);a.sets=angular.copy(e.sets);a.dvpresets=angular.copy(e.dvpresets);a.settings=angular.copy(e.settings);a.cabslist=angular.copy(e.cabslist);a.miditable=angular.copy(e.miditable);
chrome.fileSystem.getDisplayPath(fileSystem,function(b){a.settings.installDir=b})}catch(c){e=null,debug&&console.log("error Prefs file broken"),debug||tracker.sendEvent("Error","Prefs broken")}else debug&&console.log("Prefs Empty");a.$broadcast("PrefsReady");b()};e.readAsText(h)})},onError)};c.doCache=function(){fileSystem.getFile(CACHEFILE,{create:!1},function(a){c.initCache(c.getAllFiles)},c.getAllFiles)};c.getAllFiles=function(){fileSystem&&(debug&&console.log("Getting All Files..."),c.listPresets())};
c.initCache=function(b){debug&&console.log("(Init Cache)");fileSystem.getFile(CACHEFILE,{create:!1},function(e){e.file(function(e){var c=new FileReader;c.onloadend=function(e){this.result.length&&(e=angular.fromJson(this.result),a.presets=angular.copy(e.presets),a.cabslist=angular.copy(e.cabslist),a.pllist=angular.copy(e.pllist),a.$broadcast("CacheLoaded"),b())};c.readAsText(e)})},onError)};c.listPresets=function(){debug&&console.log("__Listing Presets__");var b=c.listCabs,e=0,h={};fileSystem.createReader().readEntries(function(c){if(c.length){for(var d in c)c.hasOwnProperty(d)&&
c[d].isFile&&"gfx"==c[d].name.substr(c[d].name.lastIndexOf(".")+1)&&e++;if(e){debug&&console.log("Found "+e+" presets");var q=0;a.presets={};var p=0;for(d in c)c.hasOwnProperty(d)&&c[d].isFile&&"gfx"==c[d].name.substr(c[d].name.lastIndexOf(".")+1)&&fileSystem.getFile(c[d].name,{create:!1},function(c){c.file(function(c){var d=new FileReader;d.onloadend=function(){try{var c=angular.fromJson(this.result);h[c.id]=c}catch(d){debug&&console.log("error Broken preset file"),p++}e-1==q++&&(a.presets=angular.copy(h),
b())};d.readAsText(c)})},onError);p&&(debug||tracker.sendEvent("Error","Presets broken"))}else debug&&console.log("No preset"),h={},a.presets={},b()}else debug&&console.log("No result"),a.presets={},b()},onError)};c.listCabs=function(){debug&&console.log("__Listing Cabs__");var b=c.listPlFiles;fileSystem.getDirectory(CABSFOLDER,{create:!0},function(e){e.createReader().readEntries(function(e){if(e.length){var c=0,d=0,q=0,p;for(p in e)e.hasOwnProperty(p)&&e[p].isFile&&"wav"==e[p].name.substr(e[p].name.lastIndexOf(".")+
1)&&c++;debug&&console.log("Found "+c+" Cabs");a.hasOwnProperty("cabslist")&&(d=Object.size(a.cabslist));for(p in e)if(e.hasOwnProperty(p)&&e[p].isFile&&"wav"==e[p].name.substr(e[p].name.lastIndexOf(".")+1)){var g=!0,r;for(r in a.cabslist)a.cabslist.hasOwnProperty(r)&&a.cabslist[r].file==e[p].name&&(g=!1);g?(g="Cab"+d++,a.cabslist[g]={id:g,name:e[p].name.substr(0,e[p].name.indexOf(".wav")),file:e[p].name},c==d&&b()):(q++,c==q&&b())}}else debug&&console.log("No Cab"),b()},onError)},onError)};c.listPlFiles=
function(){debug&&console.log("__Listing Player Files__");var b=c.fileSystemReady;fileSystem.getDirectory(PLFOLDER,{create:!0},function(e){var c=e.createReader();(function(e){c.readEntries(function(e){a.pllist={};if(e.length){var c=0,h=1,d;for(d in e)if(e.hasOwnProperty(d)&&e[d].isFile){var l=e[d].name.substr(e[d].name.lastIndexOf(".")+1);"wav"!=l&&"mp3"!=l||c++}debug&&console.log(c+" Player Files Found");for(d in e)e.hasOwnProperty(d)&&e[d].isFile&&(l=e[d].name.substr(e[d].name.lastIndexOf(".")+
1),"wav"==l||"mp3"==l)&&(l="Pl"+h++,a.pllist[l]={id:l,name:e[d].name,file:e[d].name},c==h-1&&b())}else debug&&console.log("No Player File"),b()},onError)})()},onError)};c.renamePreset=function(b,e,c){debug&&console.log("renamePreset");debug&&console.log(b+" "+e+" "+c);var d=angular.copy(a.presets[c]),m;for(m in a.presets)a.presets.hasOwnProperty(m)&&a.presets[m].name==e&&(e+=" - copy",d.name=e);fileSystem.getFile(e+".gfx",{create:!0},function(c){c.createWriter(function(c){var h=new Blob([angular.toJson(d)],
{type:"application/json"});c.onwriteend=function(c){fileSystem.getFile(b+".gfx",{create:!1},function(a){a.remove(function(){},onError)},onError);a.presets[m].name=e;setTimeout(function(){a.$broadcast("renamePresetEnded")},10)};c.onerror=function(a){debug&&console.log(a)};c.write(h)})},onError)};c.delPlFile=function(a){};c.updatePrefs=function(b){fileSystem.getFile(PREFSFILE,{create:!1},function(e){e.remove(function(){fileSystem.getFile(PREFSFILE,{create:!0},function(e){var c=new Blob([b],{type:"application/json"});
e.createWriter(function(b){b.onwriteend=function(b){setTimeout(function(){a.$broadcast("updatePrefsEnded")},100)};b.onerror=function(a){debug&&console.log(a)};b.write(c)})},onError)},onError)},onError)};c.fileSystemReady=function(){a.$broadcast("FileSystemReady")};c.clearAllFiles=function(){fileSystem.createReader().readEntries(function(a){if(a.length)for(var b in a)a.hasOwnProperty(b)&&fileSystem.getFile(a[b].name,{create:!1},function(a){a.remove(function(){},onError)},onError);else debug&&console.log("No result")})};
return c}]);
function loadCabIR(a,c,b){fileSystem.getDirectory(CABSFOLDER,{create:!1},function(d){d.getFile(c,{create:!1},function(f){f.file(function(f){var c=new FileReader;c.onloadend=function(){context.decodeAudioData(this.result,function(f){if(1==f.numberOfChannels){var e=new Float32Array(f.length),e=f.getChannelData(0);f=context.createBuffer(2,f.length,context.sampleRate);f.getChannelData(0).set(e);f.getChannelData(1).set(e)}cabBuffers[a]=f;return"undefined"!==typeof b?b():!0})};c.readAsArrayBuffer(f)})},onError)},
onError)}function loadPlFile(a,c){fileSystem.getDirectory(PLFOLDER,{create:!1},function(b){b.getFile(a,{create:!1},function(a){a.file(function(a){var b=new FileReader;b.onloadend=function(){context.decodeAudioData(this.result,function(b){playerBuffers=b;return"undefined"!==typeof c?c(a,!1):!0})};b.readAsArrayBuffer(a)})},onError)},onError)}
var loadExternals=function(a,c){this.files=a||{};numberOfFiles=filesLoaded=0;loadFiles(this.files,c)},loadFile=function(a,c,b,d){var f=new XMLHttpRequest;f.open("GET",c[a],!0);f.responseType="arraybuffer";f.onload=function(){filesLoaded++;context.decodeAudioData(f.response,function(f){b[a]=f;filesLoaded===numberOfFiles&&d(b)})};f.send()},loadFiles=function(a,c){var b={};a.forEach(function(a,f){for(var e in a)a.hasOwnProperty(e)&&(numberOfFiles++,loadFile(e,a,b,c))})},CabIRs=new loadExternals([{Guitar1:"audio/IRs/Edge-1.wav",
Guitar2:"audio/IRs/Centre-1.wav"}],function(a){cabBuffers=a});
function handleIRs(a){var c=Object.size(angular.element("#PresetCtrl").scope().cabslist);if(!pro&&5<=c)angular.element("#PresetCtrl").scope().showPro();else for(angular.element("#PresetCtrl").scope().$apply(function(){angular.element("#PresetCtrl").scope().updloadInfo=null}),c=0;c<a.length;c++){if(!a[c].type.match("audio/wav")){debug&&console.log("Wop...");angular.element("#PresetCtrl").scope().$apply(function(){angular.element("#PresetCtrl").scope().updloadInfo="Only .wav files are accepted."});
break}var b=new FileReader;b.onloadend=function(a,b,e){return function(c){var l=new Blob([c.target.result],{type:"audio/wav"});fileSystem.getDirectory(CABSFOLDER,{create:!1},function(c){c.getFile(a.name,{create:!0},function(c){c.createWriter(function(c){c.onwriteend=function(c){c=Object.size(angular.element("#PresetCtrl").scope().cabslist);c++;c="Cab"+c;angular.element("#PresetCtrl").scope().cabslist[c]={id:c,name:a.name.substr(0,a.name.indexOf(".wav")),file:a.name};b==e-1&&angular.element("#PresetCtrl").scope().$apply()};
c.onerror=function(a){debug&&console.log(a)};c.write(l)})},onError)},onError)}}(a[c],c,a.length);b.onload=void 0;b.readAsArrayBuffer(a[c])}}function handleIRSelect(a){handleIRs(a.target.files)}function handleIRDragOver(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"}function handleIRDrop(a){a.stopPropagation();a.preventDefault();handleIRs(a.dataTransfer.files)}document.querySelector("#inputIRs").addEventListener("change",handleIRSelect,!1);
document.querySelector("#dropIRs").addEventListener("dragover",handleIRDragOver,!1);document.querySelector("#dropIRs").addEventListener("drop",handleIRDrop,!1);
function handleFiles(a){var c=Object.size(angular.element("#PresetCtrl").scope().pllist);if(!pro&&5<=c)angular.element("#PresetCtrl").scope().showPro();else for(angular.element("#PresetCtrl").scope().$apply(function(){angular.element("#PresetCtrl").scope().updloadInfo=null}),c=0;c<a.length;c++){if(!a[c].type.match("audio/wav")&&!a[c].type.match("audio/mp3")){debug&&console.log("Wop...");angular.element("#PresetCtrl").scope().$apply(function(){angular.element("#PresetCtrl").scope().updloadInfo="Only .wav or .mp3 files are accepted."});
break}$("#PresetCtrl").scope().loading=!0;$("#PresetCtrl").scope().$apply();var b=new FileReader;b.onloadend=function(a){return function(b){playerBlob=new Blob([b.target.result],{type:"audio/wav"});context.decodeAudioData(b.target.result,function(b){playerBuffers=b;$("#PresetCtrl").scope().initPlayer(a)})}}(a[c]);b.onload=void 0;b.readAsArrayBuffer(a[c])}}function handleFileSelect(a){handleFiles(a.target.files)}
function handleFileDragOver(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"}function handleFileDrop(a){a.stopPropagation();a.preventDefault();handleFiles(a.dataTransfer.files)}document.querySelector("#files").addEventListener("change",handleFileSelect,!1);document.querySelector("#dropzone").addEventListener("dragover",handleFileDragOver,!1);document.querySelector("#dropzone").addEventListener("drop",handleFileDrop,!1);app.controller("PresetCtrl",["$scope","FS",function(a,c){a.preset={};a.orderProp="order";a.modified=!1;a.loading=!0;a.debug=debug;a.error404=!1;a.currentPage=0;a.pageSize=10;a.midilearn={state:!1,scope:"global"};a.tabview=0;a.open=0;a.recording=!1;a.playing=!1;a.plStorable=!1;a.canUpdatePrefs=!0;a.$on("PrefsReady",function(){debug&&console.log("..PrefsReady..");a.$apply()});a.$on("FileSystemReady",function(){debug&&console.log("..FileSystemReady..");a.$apply(function(){a.loading=!1;setTimeout(function(){a.$apply(function(){a.init()})},
500)})});a.$on("CacheLoaded",function(){a.$apply()});a.$on("UpdatePrefs",function(){a.updatePrefs()});c.init();a.init=function(b){debug&&console.log("(init)");a.initDone=!0;$("#mainGate").val(a.settings.mainGate.val).trigger("configure");$("#mainInput").val(a.settings.mainInput.val).trigger("configure");$("#mainOutput").val(a.settings.mainOutput.val).trigger("configure");chrome.app.window.current().onClosed.addListener(function(){debug&&console.log("Closed")});a.showSets();a.settings.hasOwnProperty("lastOpened")&&
a.settings.lastOpened?(debug&&console.log("lastOpened : "+a.settings.lastOpened),a.changePreset(a.settings.lastOpened)):a.createPreset(defaults)};a.play=function(){initPlay();connectAll();audioSource.noteOn(0)};a.stop=function(){webkitCancelAnimationFrame(TuneFrame);void 0!==audioSource&&2==audioSource.playbackState&&audioSource.noteOff(context.currentTime)};a.newPreset=function(){var b=angular.copy(defaults.newPreset),e={};e.preset=b;a.createPreset(e)};a.changePreset=function(b,e){e="undefined"!==
typeof e?e:!1;debug&&console.log("(changePreset)");if(b)if(a.presets.hasOwnProperty(b)){if(a.preset.id!=b){a.error404=!1;var c={};c.preset=a.presets[b];return a.createPreset(c,e)}}else if(a.defaults.factory.hasOwnProperty(b)){if(a.preset.id!=b)return a.error404=!1,c={},c.preset=a.defaults.factory[b],a.createPreset(c,e)}else debug&&console.log("(error404)"),a.newPreset()};a.devicesView=function(a){var b={},c;for(c in a.devices)a.devices.hasOwnProperty(c)&&(b[a.id+c]=a.devices[c]);return b};a.createPreset=
function(b,c){void 0!==liveInput&&liveInput.disconnect();a.plStop();for(var d in Nodes)if(Nodes.hasOwnProperty(d)&&"inputScard"!=d&&"outputScard"!=d){var l=Nodes[d],m;for(m in l)l.hasOwnProperty(m)&&(l[m].disconnect(),delete l[m])}debug&&console.log("(createPreset)");presetInit=!0;globalI=0;jsPlumb.detachEveryConnection();jsPlumb.deleteEveryEndpoint();a.modified=!1;a.device={};a.preset=angular.copy(b.preset);a.activePreset=a.preset.id;a.settings.lastOpened=a.preset.id;l=a.preset.devices;for(d in l)l.hasOwnProperty(d)&&
addTodevicesChain(l[d]);connectAll();a.updatePrefs()};a.filterByDevice=function(a,b){var c=[],d;for(d in a)a.hasOwnProperty(d)&&a[d].name==b&&c.push(a[d]);return c};a.ObjToArray=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b};a.changeDvPresetValues=function(b){b=a.dvpresets[b];debug&&console.log(a.dvpresets);for(var c in b){if(b.hasOwnProperty(c)&&"pots"==c)for(var d in b[c])b[c].hasOwnProperty(d)&&(a.device[c][d].val=b[c][d].val,a.device.node.params[d](b[c][d].val));
if(b.hasOwnProperty(c)&&"selects"==c)for(d in b[c])b[c].hasOwnProperty(d)&&(a.device[c][d].selected=b[c][d].selected,a.device.node.params[d](b[c][d].selected));if(b.hasOwnProperty(c)&&"switchers"==c)for(d in b[c])b[c].hasOwnProperty(d)&&(a.device[c][d].val=b[c][d].val,a.device.node.params[d](b[c][d].val))}a.modified=!0};a.filterByTab=function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d].tab==b&&(c[d]=a[d]);return c};a.filterPhonesByNameOrSnippet=function(a,b){var c=[],d=RegExp(b,"i");angular.forEach(a,
function(a){(a.name.match(d)||a.snippet.match(d))&&c.push(a)});return c};a.savePreset=function(b){function c(){fileSystem.getFile(a.preset.name+".gfx",{create:!0},function(c){var d=new Blob([angular.toJson(l)],{type:"application/json"});c.createWriter(function(c){c.onwriteend=function(c){a.$apply(function(){a.presets[l.id]=angular.copy(l);if(a.activeSet&&1!=a.activeSet.id&&2!=a.activeSet.id){for(var c=a.activeSet.id,d=!0,e=0;e<a.sets[c].presets.length;e++)if(a.sets[c].presets[e]==l.id){d=!1;break}d&&
(a.sets[c].presets.push(l.id),a.updatePrefs())}a.modified=!1;a.loadSet();a.loading=!1;b&&a.changePreset(l.id)})};c.onerror=function(b){debug&&console.log(b);a.loading=!1};c.write(d)})},onError)}var d=Object.size(a.presets);if(!pro&&5<=d)a.showPro();else{a.loading=!0;var l=angular.copy(a.preset),m;for(m in l.devices)if(l.devices.hasOwnProperty(m))if(0===m.indexOf("deleted_"))debug&&console.log("Found deleted_");else{var d=l.devices[m],q;for(q in d)if(!d.hasOwnProperty(q)||"node"!=q&&"class"!=q&&"selected"!=
q||delete d[q],d.hasOwnProperty(q)&&("pots"==q||"selects"==q||"switchers"==q)){var p=d[q],g;for(g in p)if(p.hasOwnProperty(g)){var r=p[g],n;for(n in r)!r.hasOwnProperty(n)||"step"!=n&&"min"!=n&&"max"!=n&&"tab"!=n&&"options"!=n||delete r[n]}}}if(fileSystem){"newpreset"==a.preset.id&&(b=!0);0==a.preset.id.indexOf("preset")&&(b=!0);b||(debug&&console.log("Saving Preset..."),q=a.preset.id,a.presets.hasOwnProperty(q)?a.preset.name!=a.presets[q].name?(debug&&console.log("Removing old file with old name..."),
fileSystem.getFile(a.presets[q].name+".gfx",{create:!1},function(a){a.remove(function(){debug&&console.log("File removed.");debug&&console.log("Store - after removed");c()},onError)},onError)):(debug&&console.log("Store - preset existed and name has no change"),fileSystem.getFile(a.preset.name+".gfx",{create:!1},function(a){a.remove(function(){c()},onError)},onError)):(debug&&console.log("Store - preset not existed before????"),b=!0));if(b){debug&&console.log("Saving Preset As ...");l.id=createUniqID();
a.presets[l.id]={};for(m in a.presets)a.presets.hasOwnProperty(m)&&a.presets[m].name==a.preset.name&&(a.preset.name=angular.copy(a.preset.name)+" - copy",l.name=angular.copy(a.preset.name));debug&&console.log("Store - saving preset as");c()}debug||tracker.sendEvent("Preset","Save")}}};a.listIRs=function(){listIRs(fileSystem)};a.ready=function(){mainLvIn.display("tops")};a.delPreset=function(b){debug&&console.log("del : "+a.presets[b].name+".gfx");fileSystem.getFile(a.presets[b].name+".gfx",{create:!1},
function(c){c.remove(function(){debug&&console.log("File removed.");debug&&console.log(b);angular.forEach(a.sets,function(c,d){for(var e=0;e<a.sets[d].presets.length;e++)a.sets[d].presets[e]==b&&a.sets[d].presets.splice(e,1)},log);delete a.presets[b];a.updatePrefs();a.$apply(function(){a.loadSet()})},onError)},function(){delete a.presets[b];a.updatePrefs();a.$apply(function(){a.loadSet()})})};a.saveCabslist=function(b){debug&&console.log("Save Cablist");a.updloadInfo=null;var c={},d=1;$(angular.element("#allclist li")).each(function(b,
f){var q=$(f)[0].id,q=angular.copy(a.cabslist[q]);q.id="Cab"+d;c["Cab"+d]=q;d++});a.cabslist=angular.copy(c);a.updateCabsinSelects(a.cabslist);a.updatePrefs();a.$apply(function(){})};a.delCab=function(b){a.loading=!0;var c=a.cabslist[b].file;fileSystem.getDirectory(CABSFOLDER,{create:!1},function(d){d.getFile(c,{create:!1},function(d){d.remove(function(){debug&&console.log("File removed."+c);a.loading=!1;delete a.cabslist[b];a.$apply(function(){})},function(c){debug&&console.log(c);a.loading=!1;delete a.cabslist[b];
a.$apply(function(){})})},function(c){debug&&console.log(c);a.loading=!1;delete a.cabslist[b];a.$apply(function(){})})},onError)};a.updateCabsinSelects=function(b){for(var c in a.preset.devices)a.preset.devices.hasOwnProperty(c)&&"Cabinet"==a.preset.devices[c].name&&(debug&&console.log(a.preset.devices[c].defaultscabs),a.preset.devices[c].selects.type.options=a.preset.devices[c].merger(a.preset.devices[c].defaultscabs,b))};a.delDvPreset=function(b){debug&&console.log("del : "+b);delete a.dvpresets[b];
a.updatePrefs()};a.saveDvPresetname=function(b){var c={},c=a.dvpresets[b];a.dvpresets[c.id]=angular.copy(c);a.updatePrefs()};a.saveDvPreset=function(b){var c=jQuery.extend(!0,{},a.device),d={};d.name=c.name;d.id="DV"+Math.floor(1E4*Math.random()+1);d.presetname=b?b:"No name";for(var l in c){if(c.hasOwnProperty(l)&&"pots"==l){d.pots={};for(var m in c[l])c[l].hasOwnProperty(m)&&(d.pots[m]={},d.pots[m].id=c[l][m].id,d.pots[m].name=c[l][m].name,d.pots[m].val=c[l][m].val)}if(c.hasOwnProperty(l)&&"selects"==
l)for(m in d.selects={},c[l])c[l].hasOwnProperty(m)&&(d.selects[m]={},d.selects[m].id=c[l][m].id,d.selects[m].name=c[l][m].name,d.selects[m].selected=c[l][m].selected);if(c.hasOwnProperty(l)&&"switchers"==l)for(m in d.switchers={},c[l])c[l].hasOwnProperty(m)&&(d.switchers[m]={},d.switchers[m].id=c[l][m].id,d.switchers[m].name=c[l][m].name,d.switchers[m].val=c[l][m].val)}a.dvpresets[d.id]=angular.copy(d);a.updatePrefs();a.modified=!1;a.dvpresetname=""};a.enableEdit=function(){a.edit=!0};a.disableEdit=
function(){2<a.preset.name.length&&(a.edit=!1,a.modified=!0)};a.enablePEdit=function(b){a.presets[b].tmppresetname=angular.copy(a.presets[b].name);a.presets[b].edit=!0};a.disablePEdit=function(b){2<a.presets[b].name.length&&a.presets[b].edit&&(c.renamePreset(a.presets[b].tmppresetname,a.presets[b].name,b),delete a.presets[b].edit,delete a.presets[b].tmppresetname)};a.$on("renamePresetEnded",function(){a.$apply()});a.enableDvpEdit=function(b){a.dvpresets[b].tmppresetname=angular.copy(a.dvpresets[b].presetname);
a.dvpresets[b].edit=!0};a.disableDvpEdit=function(b){2<a.dvpresets[b].presetname.length&&a.dvpresets[b].edit&&(a.modified=!0,delete a.dvpresets[b].edit,delete a.dvpresets[b].tmppresetname,a.saveDvPresetname(b))};a.addDevice=function(b){debug&&console.log("AddDevice...");var c=a.preset.devices,d={};d.name=angular.copy(b);b=d.name+Math.floor(1E4*Math.random());for(var l in c)c.hasOwnProperty(l)&&l==b&&(b=d.name+Math.floor(1E4*Math.random()));d.id=b;a.preset.devices[b]=angular.copy(d);addTodevicesChain(d);
a.modified=!0};a.editDevice=function(b){var c=a.preset.devices;a.device=c[b];a.tabview=0;for(var d in c)c.hasOwnProperty(d)&&(c[d].selected=!1);null!=lvIn&&lvIn.stop();null!=lvOut&&lvOut.stop();a.device.input.length&&(lvIn=new mainLevelView(Nodes[a.device.id].input,"#inputDevice"),lvIn.start());a.device.output.length&&(lvOut=new mainLevelView(Nodes[a.device.id].output,"#outputDevice"),lvOut.start());debug||tracker.sendEvent("Device","Edit",a.device.name)};a.deleteDevice=function(b){debug&&console.log("del device: "+
b);jsPlumb.deleteEndpoint(b+"_input");jsPlumb.deleteEndpoint(b+"_output");delete a.preset.devices[b];a.device=0;a.modified=!0};a.unselectDevices=function(){a.device=0;for(var b in a.devices)a.devices.hasOwnProperty(b)&&(a.devices[b].selected=!1)};a.$watch("modified",function(){a.modifiedClass=a.modified?"true":"false"});a.affpresets=function(){};a.affdvpresets=function(){$("#DvPresetDialog").modal();$("#DvPresetDialog").draggable();$("#DvPresetDialog .modal-body").show()};a.presetNumber=function(a){a++;
return 10>a?"0"+a:a};a.cabNumber=function(a){a++;return"Cab"+a};a.isCustomCab=function(a){if(void 0!==a.file)return a.id+" "};a.addSet=function(){a.sets.newSet={};a.sets.newSet.name="New Set";a.sets.newSet.presets={};a.sets.newSet.id=Math.floor(1E5*Math.random()+1);a.sets.newSet.edit=!0};a.enableSetEdit=function(b){a.sets[b].tmpname=angular.copy(a.sets[b].name);a.sets[b].edit=!0};a.disableSetEdit=function(b){a.sets.hasOwnProperty("newSet")&&(2<a.sets.newSet.name.length&&a.sets.newSet.edit)&&(a.sets[b]=
{},a.sets[b]=angular.copy(a.sets.newSet),delete a.sets.newSet);delete a.sets[b].edit;delete a.sets[b].tmpname;a.setId=b;a.viewSet(b)};a.viewSet=function(b){debug&&console.log("(ViewSet)");a.setview=[];a.setId=b;b=a.sets[b].presets;for(var c=0;c<b.length;c++)if(a.presets.hasOwnProperty(b[c])){var d={name:angular.copy(a.presets[b[c]].name),id:angular.copy(a.presets[b[c]].id)};a.setview.push(d)}};a.delSet=function(b){a.setview=[];a.setId=!1;delete a.sets[b]};a.saveSets=function(){a.$apply(function(){a.loadSet();
a.showSets()});a.updatePrefs()};a.delInSetView=function(b){a.sets[a.setId].presets.splice(b,1);a.setview.splice(b,1)};a.updateSet=function(b){debug&&console.log("(UpdateSet)");var c=a.sets[a.setId];c.presets=[];a.setview=[];$(angular.element("#plist li")).each(function(b,d){var f=$(d).data("id");c.presets.push(f);f={name:angular.copy(a.presets[f].name),id:angular.copy(a.presets[f].id)};a.setview.push(f)});$("#allplist").sortable("cancel")};a.loadSet=function(){debug&&console.log("LoadSet");if(a.activeSet){var b=
a.activeSet.id;a.activeList=[];a.settings.activeSetId=a.activeSet.id;if(1==b)a.activeList=a.ObjToArray(a.presets);else if(2==b){var c=a.defaults.factory;angular.forEach(c,function(b,d){a.activeList.push(c[d])},log)}else for(c=a.sets[b].presets,b=0;b<c.length;b++)a.activeList.push(a.presets[c[b]]);a.activeList.length||a.activeList.push({id:0,name:"No preset"})}else a.activeList=a.ObjToArray(a.presets);setTimeout(function(){a.$apply(function(){})})};a.loadCurrentSet=function(){a.loadSet();a.updatePrefs()};
a.showSets=function(){a.allSets=[];a.allSets.push({id:"1",name:"All User Presets"});a.allSets.push({id:"2",name:"Factory Presets"});angular.forEach(a.sets,function(b,c){a.allSets.push(a.sets[c])},log);a.activeSetId=a.settings.activeSetId;for(var b=0;b<a.allSets.length;b++)if(a.allSets[b].id==a.activeSetId){a.activeSet=a.allSets[b];break}return a.allSets};a.toggleTuner=function(){a.settings.tuner.enable=!a.settings.tuner.enable;a.settings.tuner.enable?tune.start():null!=tune&&tune.stop();a.tunerMute();
a.updatePrefs()};a.toggleTunerMute=function(){a.settings.tuner.mute=!a.settings.tuner.mute;a.tunerMute();a.updatePrefs()};a.tunerMute=function(){tunerMute.gain.value=a.settings.tuner.enable?a.settings.tuner.mute?0:1:1};a.updatePrefs=function(){if(fileSystem)if(a.canUpdatePrefs)if(a.loading)debug&&console.log("No updating cause loading");else{debug&&console.log("Saving Prefs...");a.canUpdatePrefs=!1;var b=angular.toJson({sets:angular.copy(a.sets),dvpresets:angular.copy(a.dvpresets),settings:angular.copy(a.settings),
cabslist:angular.copy(a.cabslist),miditable:angular.copy(a.miditable)}),d=!0;try{angular.fromJson(b)}catch(h){debug&&console.log("CAN NOT STORE PREFS, Datas Broken!!!!!!!!"),debug&&console.log(b),d=!1}d&&c.updatePrefs(b)}else debug&&console.log("No updating cause canUpdatePrefs == false")};a.$on("updatePrefsEnded",function(){debug&&console.log("update ended");a.canUpdatePrefs=!0;a.loadSet()});a.affMidi=function(b,c,d){"undefined"!==typeof b&&("undefined"!==typeof c&&"undefined"!==typeof d)&&(a.midilearn.device=
c.name,a.midilearn.deviceid=c.id,a.midilearn.paramtype=d,a.midilearn.param=b.name,a.midilearn.paramid=b.id,a.midilearn.name=c.name+" "+b.name)};a.saveMidi=function(){a.updatePrefs()};a.saveMidiCtrl=function(){var b=angular.copy(a.midilearn);if("global"==b.scope){a.miditable||(a.miditable={});var c=a.miditable}else a.preset.hasOwnProperty("miditable")||(a.preset.miditable={}),c=a.preset.miditable,a.modified=!0;delete b.state;delete b.button;c.hasOwnProperty(b.midi)||(c[b.midi]=[]);c[b.midi].push(b);
delete a.midilearn.midi};a.delMidiCtrl=function(b,c,d){var l=null,l="global"==c.scope?a.miditable:a.preset.miditable;l[b].splice(d,1);l[b].length||delete l[b]};a.changeMidiScope=function(a,b){};a.toggleMidiLearn=function(){a.midilearn.state=!a.midilearn.state;a.midilearn.button=a.midilearn.state?"Learning...":"Learn"};a.handleMIDIMessage=function(b){for(var c=0;c<b.data.length;c++);var d=null;if(194==b.data[0])d="PC";else if(178==b.data[0])d="CC";else if(144==b.data[0])d="Note";else return;d+=b.data[1];
if(a.midilearn.state)a.midilearn.midi=d,a.toggleMidiLearn(),a.$apply(a.midilearn);else{if(194==b.data[0]){var l=a.activeList;0<=b.data[1]-0&&b.data[1]-0<=l.length&&a.changePreset(l[b.data[1]-0].id,!0)}var l=function(a,b,c){c=a[b.paramtype][b.paramid].val;a[b.paramtype][b.paramid].val=!c;a.node.params[b.paramid](!c)},m=function(a,b,c){var d=a[b.paramtype][b.paramid].min,e=a[b.paramtype][b.paramid].step;c=c/(127/(a[b.paramtype][b.paramid].max-d))+d;c=Math.round(c*(1/e))/(1/e);a[b.paramtype][b.paramid].val=
c;a.node.params[b.paramid](c)},c=a.preset.miditable,q=a.miditable,p=a.preset;if(Object.size(c)&&c.hasOwnProperty(d))for(var g=c[d],c=0;c<g.length;c++){if("switchers"==g[c].paramtype)for(var r in p.devices)p.devices[r].name==g[c].device&&l(p.devices[r],g[c],null);if("pots"==g[c].paramtype)for(r in p.devices)p.devices[r].name==g[c].device&&m(p.devices[r],g[c],b.data[2])}if(Object.size(q)&&q.hasOwnProperty(d))for(g=q[d],c=0;c<g.length;c++){if("switchers"==g[c].paramtype)for(r in p.devices)p.devices[r].name==
g[c].device&&l(p.devices[r],g[c],null);if("pots"==g[c].paramtype)for(r in p.devices)p.devices[r].name==g[c].device&&m(p.devices[r],g[c],b.data[2])}a.$apply(p)}};a.displayInfos=function(a){switch(a){case "about":var b="demo";pro&&(b="full");$("#infosModal .modal-header h3").html("GuitarFX");$("#infosModal .modal-body").html("<p>Version : "+version+"</p><p>Licence Type : "+b+'</p><p>Credits : <small>Pichard Yoann</small></p><p></p><p><small><a href="https://plus.google.com/communities/102489901490134079342" target="_blank">Google + GuitarFX Community</a></small></p>')}a&&
$("#infosModal").modal("show")};var b=null,d=null;a.toggleRecording=function(c){if("undefined"!==typeof c&&c)audioRecorder.stop(),audioRecorder.clear(),a.recording=!1;else if(a.recording)debug&&console.log("Stop recording"),audioRecorder.stop(),a.recording=!1,a.plFileName=dateFormat()+".wav",audioRecorder.exportWAV(function(b){playerBlob=new Blob([b.buffer],{type:"audio/wav"});context.decodeAudioData(b.buffer,function(b){playerBuffers=b;a.$apply(function(){a.plStorable=!0})})}),window.webkitCancelAnimationFrame(b),
b=null;else if(audioRecorder){debug&&console.log("Recording");audioSource.hasOwnProperty("playbackState")&&2==audioSource.playbackState&&audioSource.stop(0);audioRecorder.clear();audioRecorder.record();a.recording=!0;var d=context.currentTime,h=$("#total"),l=function(){var a=Math.round(100*(context.currentTime-d))/100;h.html(a);b=window.webkitRequestAnimationFrame(l)};l()}};a.togglePlaying=function(){a.recording?a.toggleRecording():a.playing?a.plStop():a.plPlay()};a.playerMeter=null;a.plPlay=function(){if((!audioSource.hasOwnProperty("playbackState")||
2!=audioSource.playbackState)&&playerBuffers.length){audioSource=context.createBufferSource();audioSource.buffer=playerBuffers;audioSource.loop=!0;connectAll();audioSource.start(0,playerStartOffset);playerIsPlaying=a.playing=!0;playerStartTime=audioSource.context.currentTime;var b=$("#timing");$("#bar").width();var c=$("#bar");c.slider({stop:function(a,b){playerStartOffset=audioSource.buffer.duration*b.value/100}});var h=function(){if(playerIsPlaying){var a=Math.round(100*((audioSource.context.currentTime-
(playerStartTime-playerStartOffset))%audioSource.buffer.duration))/100;b.html(a);a=Math.round(100*(100*a/audioSource.buffer.duration))/100;c.slider({value:a});d=window.webkitRequestAnimationFrame(h)}};h();playerMeter=new mainLevelView(audioSource,"#playerMeter");playerMeter.start()}};a.plStop=function(){debug&&console.log("Stop");null!=audioSource.buffer&&(playerStartOffset=(audioSource.context.currentTime-playerStartTime)%audioSource.buffer.duration,audioSource.stop(0),playerIsPlaying=!1,a.playing=
!1,window.webkitCancelAnimationFrame(d),d=null,playerMeter.stop())};a.stopTune=function(){tune.stop()};a.savePlFile=function(){var b=Object.size(a.pllist);if(!pro&&5<=b)a.showPro();else if(a.plStorable){var c=playerBlob,d=a.plFileName;debug&&console.log("Store");fileSystem.getDirectory(PLFOLDER,{create:!0},function(b){b.getFile(d,{create:!0},function(b){b.createWriter(function(b){b.onwriteend=function(b){b=createUniqID();a.pllist[b]={id:b,name:d,file:d};a.updatePrefs();a.$apply()};b.onerror=function(a){debug&&
console.log(a)};b.write(c)})},onError)},onError)}};a.initPlayer=function(b,c){debug&&console.log("(initPlayer)");a.recording&&a.toggleRecording(!0);a.loading=!1;a.plFileName=b.name;var d=$("#total"),l=Math.round(100*playerBuffers.duration)/100;d.html(l);$("#PlayerModal").modal("hide");a.$apply(function(){a.plStorable="undefined"!==typeof c?c:!0})};a.plLoadFile=function(b){loadPlFile(a.pllist[b].file,a.initPlayer)};a.delPlFile=function(b){var c=a.pllist[b].file;fileSystem.getDirectory(PLFOLDER,{create:!1},
function(d){d.getFile(c,{create:!1},function(d){d.remove(function(){debug&&console.log("File removed : "+c);a.$apply(function(){delete a.pllist[b]})},onError)},onError)},onError)};a.resetPrefs=function(){fileSystem.getFile(PREFSFILE,{create:!1},function(a){a.remove(function(){debug&&console.log("Prefs removed...")},onError)},onError)};a.clearAllFiles=function(){c.clearAllFiles()};a.clearCache=function(){fileSystem.getFile(CACHEFILE,{create:!1},function(a){a.remove(function(){debug&&console.log("Prefs removed...")},
onError)},onError)};a.showPro=function(){$("#infosModal .modal-header h3").html("Get Full Version");$("#infosModal .modal-body").html("<p>This is as trial version. Enable all features:<br><small>- Unlimited number of presets</br>- Unlimited number of cabinets<br/>- Unlimited number of audio files<br/>- and more to come...</p>");$('</small><br/><p><button class="buyButton" id="buyPro">Buy Full Version</button><p>').appendTo("#infosModal .modal-body");$("#buyPro").click(function(){a.buy();$("#infosModal").modal("hide")});
$("#infosModal").modal("show");debug||tracker.sendAppView("ProView")};a.buy=function(){var a=null,b="";debug?(a={},b="eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiIxNDIwNDk1MzA5NDM1MjE2ODU3MSIsImF1ZCI6Ikdvb2dsZSIsInR5cCI6Imdvb2dsZS9wYXltZW50cy9pbmFwcC9pdGVtL3YxIiwiaWF0IjoxMzc3NTEzMzczLCJleHAiOjQ0NDQ0NDQ0NDQsInJlcXVlc3QiOnsibmFtZSI6IkZ1bGwgVmVyc2lvbiIsImRlc2NyaXB0aW9uIjoiQWxsIGZlYXR1cmVzIHlvdSBuZWVkIiwicHJpY2UiOiI0LjQ5IiwiY3VycmVuY3lDb2RlIjoiRVVSIiwic2VsbGVyRGF0YSI6IllvYW5uIn19.-o7UqqObFMI2t7Jz5CfpZ1XvudSqYpTXJop7UPQlsQc"):
(a={env:"prod"},b="eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiIwNzc0OTY5MDk5OTkwOTg4NTE1NyIsImF1ZCI6Ikdvb2dsZSIsInR5cCI6Imdvb2dsZS9wYXltZW50cy9pbmFwcC9pdGVtL3YxIiwiaWF0IjoxMzc3Nzc0ODMwLCJleHAiOjQ0NDQ0NDQ0NDQsInJlcXVlc3QiOnsiY3VycmVuY3lDb2RlIjoiRVVSIiwicHJpY2UiOiI0LjQ5IiwibmFtZSI6Ikd1aXRhckZYIEZ1bGwgVmVyc2lvbiIsInNlbGxlckRhdGEiOiJzb21lIG9wYXF1ZSBkYXRhIiwiZGVzY3JpcHRpb24iOiJVcGdyYWRlIHRvIGZ1bGwgdmVyc2lvbiJ9fQ.iCKX38hIQf-QTDIi30AmSV6_88rfrQRBv_wQzZF7Jlk");google.payments.inapp.buy({parameters:a,jwt:b,success:function(a){chrome.storage.sync.set({pro:!0},
function(){});pro=!0},failure:function(a){debug&&console.log("Failure: "+JSON.stringify(a))}})};a.changeDir=function(){chrome.fileSystem.chooseEntry({type:"openDirectory"},function(b){b?(c.onFileSystemOpened(b),chrome.storage.sync.set({installDir:chrome.fileSystem.retainEntry(b)}),a.$apply(function(){})):console.log("No dir selected.")})}}]);function createGain(a){var c={input:["LeftMiddle"],output:["RightMiddle"],"class":"gain",deletable:!0,connections:[],position:{top:75,left:95},pots:{gain:{name:"Gain",id:"gain",tab:0,midi:!0,val:1,min:0,max:1,step:0.01},pan:{name:"Pan",id:"pan",tab:0,val:0,min:-1,max:1,step:0.01}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.gain=context.createGain();b.bypass=context.createGain();b.input=context.createGain();
b.output=context.createGain();b.dryGain=context.createGain();b.wetGain=context.createGain();b.panL=context.createGain();b.panR=context.createGain();b.merger=context.createChannelMerger(2);b.splitter=context.createChannelSplitter(2);b.bypass.gain.value=0;b.input.connect(b.dryGain);b.dryGain.connect(b.gain);b.gain.connect(b.panL);b.gain.connect(b.panR);b.panL.connect(b.merger,0,0);b.panR.connect(b.merger,0,1);b.merger.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);
a.node={};a.node.params={};a.node.params.gain=function(a){b.gain.gain.value=a};a.node.params.pan=function(a){var c=(a+1)/2;a=Math.cos(0.5*c*Math.PI);c=Math.cos(0.5*(1-c)*Math.PI);b.panL.gain.value=a;b.panR.gain.value=c};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};setCustomVals(a.node,a);return a}
function createInput(a){var c={input:[],output:["RightMiddle"],deletable:!1,connections:[],position:{top:40,left:250},pots:{}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.input=context.createGain();b.output=context.createGain();b.splitter=context.createChannelSplitter(2);b.middleGain=context.createGain();b.fakeGain=context.createGain();b.fakeGain.gain.value=0;inComp=context.createDynamicsCompressor();inComp.threshold.value=angular.element("#PresetCtrl").scope().settings.mainGate.val;
inComp.knee.value=0;inComp.ratio.value=2;b.input.connect(inComp);b.input.connect(b.middleGain);inComp.connect(b.fakeGain);b.fakeGain.connect(b.middleGain);setInterval(function(){1<=Math.abs(inComp.reduction.value)?b.middleGain.gain.value=1:0.001>=Math.abs(inComp.reduction.value)?b.middleGain.gain.value=0:b.middleGain.gain.value=Math.abs(inComp.reduction.value)},10);b.middleGain.connect(b.splitter);b.splitter.connect(b.output,0);a.node={};a.node.params={};a.node.params.mainGate=function(a){inComp.threshold.value=
a};a.node.params.mainInput=function(a){mainInput.gain.value=a};a.node.params.mainOutput=function(a){outputMix.gain.value=a};a.node.params.mainInput(angular.element("#PresetCtrl").scope().settings.mainInput.val);a.node.params.mainOutput(angular.element("#PresetCtrl").scope().settings.mainOutput.val);a.node.params.mainGate(angular.element("#PresetCtrl").scope().settings.mainGate.val);angular.element("#PresetCtrl").scope().settings.tuner.enable&&(angular.element("#PresetCtrl").scope().settings.tuner.mute?
tunerMute.gain.value=0:tunerMute.gain.value=1);return a}function createOutput(a){var c={input:["LeftMiddle"],output:[],deletable:!1,connections:[],position:{top:40,left:250},pots:{}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};c=Nodes[a.id];c.gain=context.createGain();c.input=c.gain;c.output=c.gain;return a}
function createReverb(a){var c={input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,"class":"reverb",connections:[],position:{top:50,left:150},pots:{volume:{name:"Volume",id:"volume",tab:0,val:0.8,min:0,max:1,step:0.01},mix:{name:"Mix",id:"mix",tab:0,val:20,min:0,max:100,step:0.1}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.convolver=context.createConvolver();b.input=context.createGain();
b.output=context.createGain();b.dryGain=context.createGain();b.wetGain=context.createGain();b.mixInDry=context.createGain();b.mixInWet=context.createGain();b.bypass=context.createGain();b.mixInWet.gain.value=0;b.bypass.gain.value=0;(function(){var a=new XMLHttpRequest;a.open("GET","audio/IRs/cardiod-rear-levelled.wav",!0);a.responseType="arraybuffer";a.onload=function(){context.decodeAudioData(a.response,function(a){b.convolver.buffer=a})};a.send()})();a.node={};a.node.params={};a.node.params.volume=
function(a){b.output.gain.value=a};a.node.params.mix=function(a){var c=a/100;a=Math.cos(0.5*c*Math.PI);c=Math.cos(0.5*(1-c)*Math.PI);b.mixInDry.gain.value=a;b.mixInWet.gain.value=c};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};setCustomVals(a.node,a);b.input.connect(b.dryGain);b.dryGain.connect(b.mixInDry);b.dryGain.connect(b.mixInWet);b.mixInDry.connect(b.wetGain);b.mixInWet.connect(b.convolver);b.convolver.connect(b.wetGain);
b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);return a}
function createChorus(a){var c={input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,"class":"chorus",connections:[],position:{top:60,left:160},pots:{rate:{name:"Rate",id:"rate",tab:0,val:0.05,min:0.01,max:5,step:0.01},delay:{name:"Delay",id:"delay",tab:0,val:0.001,min:0.001,max:0.06,step:0.001},depth:{name:"Depth",id:"depth",tab:0,val:0.002,min:5E-4,max:0.004,step:1E-4}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]=
{};var b=Nodes[a.id];b.delayNode=context.createDelay();b.inputNode=context.createGain();b.osc=context.createOscillator();b.gain=context.createGain();b.dryGain=context.createGain();b.wetGain=context.createGain();b.input=context.createGain();b.output=context.createGain();b.bypass=context.createGain();b.bypass.gain.value=0;b.delayNode.delayTime.value=0.001;b.gain.gain.value=0.03;b.osc.type="sine";b.osc.frequency.value=0.05;b.osc.connect(b.gain);b.gain.connect(b.delayNode.delayTime);b.osc.noteOn(0);a.node=
{};a.node.params={};a.node.params.rate=function(a){b.osc.frequency.value=a};a.node.params.delay=function(a){b.delayNode.delayTime.value=a};a.node.params.depth=function(a){b.gain.gain.value=a};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};setCustomVals(a.node,a);b.input.connect(b.dryGain);b.dryGain.connect(b.wetGain);b.dryGain.connect(b.delayNode);b.delayNode.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);
b.bypass.connect(b.output);return a}
function createOverdrive(a){var c={input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,"class":"overdrive",connections:[],position:{top:40,left:250},pots:{gain:{name:"Gain",id:"gain",tab:0,midi:!0,val:5,min:0,max:10,step:0.01},tone:{name:"Tone",id:"tone",tab:0,val:1E3,min:100,max:1E4},volume:{name:"Volume",id:"volume",tab:0,val:1,min:0,max:1,step:0.01}},selects:{type:{name:"Type",id:"type",options:{Guitar1:{id:"Guitar1",name:"Vintage"},Guitar2:{id:"Guitar2",name:"Modern"}},selected:"Guitar1",
tab:0}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.waveshaper=context.createWaveShaper();b.postWaveShaper=context.createGain();b.input=context.createGain();b.output=context.createGain();b.dryGain=context.createGain();b.wetGain=context.createGain();b.lowPass=context.createBiquadFilter();b.gain=context.createGain();b.bypass=context.createGain();b.lowPass.type="lowpass";b.bypass.gain.value=0;var d=
{Guitar1:{drive:function(a){a=Math.pow(a,2);for(var c=new Float32Array(22050),d=0;22050>d;d+=1){var f=2*d/22050-1;c[d]=(1+a)*f/(1+a*Math.abs(f))}b.waveshaper.curve=c;b.postWaveShaper.gain.value=0.05}},Guitar2:{drive:function(a){a=Math.pow(a+2,3);for(var c=new Float32Array(22050),d=0;22050>d;d+=1){var f=2*d/22050-1;c[d]=(1+a)*f/(1+a*Math.abs(f))}b.waveshaper.curve=c;b.postWaveShaper.gain.value=0.05}}},f="Guitar1";a.node={};a.node.params={};a.node.params.tone=function(a){b.lowPass.frequency.value=a};
a.node.params.volume=function(a){b.gain.gain.value=a};a.node.params.gain=function(a){d[f].drive(a);debug&&DrawCurve("#edit .ui",b.waveshaper.curve)};a.node.params.type=function(c){d.hasOwnProperty(c)&&(f=c,a.node.params.gain(a.pots.gain.val));debug&&DrawCurve("#edit .ui",b.waveshaper.curve)};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};setCustomVals(a.node,a);b.input.connect(b.dryGain);b.dryGain.connect(b.lowPass);
b.lowPass.connect(b.waveshaper);b.waveshaper.connect(b.postWaveShaper);b.postWaveShaper.connect(b.gain);b.gain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);return a}function DrawCurve(a,c){var b=document.querySelector("#visual");b.setAttribute("width",220);b.setAttribute("height",100);var b=b.getContext("2d"),d=0,f=0,e=c.length/220;for(b.beginPath();d<=c.length;){var h=f;f++;b.lineTo(h,50-50*c[d]);d=Math.round(d+e)}b.stroke()}
function createAmp(a){var c={input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,"class":"amp",connections:[],position:{top:70,left:170},pots:{drive:{name:"Drive",id:"drive",tab:0,midi:!0,val:3,min:0,max:10,step:0.01},bass:{name:"Bass",id:"bass",tab:0,val:5,min:0,max:10,step:0.01},mid:{name:"Mid",id:"mid",tab:0,val:5,min:0,max:10,step:0.01},treb:{name:"Treb",id:"treb",tab:0,val:5,min:0,max:10,step:0.01},presence:{name:"Presence",id:"presence",tab:0,val:5,min:0,max:10,step:0.01},master:{name:"Master",
id:"master",tab:0,val:8,min:0,max:10,step:0.01}},switchers:{boost:{name:"Boost",id:"boost",tab:0,val:!0},bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}},selects:{type:{name:"Type",id:"type",options:{Amp1:{id:"Amp1",name:"Class A"},Amp2:{id:"Amp2",name:"Clean US"},Amp4:{id:"Amp4",name:"German Modern"},Amp5:{id:"Amp5",name:"Brit Man"}},selected:"Amp1",tab:0}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.input=context.createGain();b.output=context.createGain();
b.dryGain=context.createGain();b.wetGain=context.createGain();b.bypass=context.createGain();b.boost=context.createGain();b.master=context.createGain();b.bypass.gain.value=0;b.waveshaper=context.createWaveShaper();b.postWaveShaper=context.createGain();b.Bfilter=context.createBiquadFilter();b.Mfilter=context.createBiquadFilter();b.Tfilter=context.createBiquadFilter();b.lowCut=context.createBiquadFilter();b.highCut=context.createBiquadFilter();b.presence=context.createBiquadFilter();b.Bfilter.type="peaking";
b.Bfilter.frequency.value=100;b.Mfilter.type="peaking";b.Mfilter.frequency.value=1700;b.Tfilter.type="peaking";b.Tfilter.frequency.value=6500;b.lowCut.type="highpass";b.lowCut.frequency.value=10;b.highCut.type="lowpass";b.highCut.frequency.value=1E4;b.presence.type="lowpass";b.presence.frequency.value=1E4;var d=b.boost.gain.value=1,f={Amp1:{drive:function(a){var c=new Float32Array(22050);a=10+3*a;for(var d=0;22050>d;d+=1){var e=2*d/22050-1;c[d]=(1+a)*e/(1+a*Math.abs(e))}b.waveshaper.curve=c;b.postWaveShaper.gain.value=
0.02},master:"---",tonestack:function(a){b.lowCut.frequency.value=350;b.highCut.frequency.value=7200;b.Bfilter.frequency.value=360;b.Mfilter.frequency.value=3500;b.Tfilter.frequency.value=8E3;d=0.5}},Amp2:{drive:function(a){a=(a+6)/4;for(var c=new Float32Array(22050),d=0;22050>d;d+=1){var e=2*d/22050-1;c[d]=(1+a)*e/(1+a*Math.abs(e))}b.waveshaper.curve=c;b.postWaveShaper.gain.value=0.08},master:"---",tonestack:function(a){b.lowCut.frequency.value=20;b.highCut.frequency.value=2E4;b.Bfilter.frequency.value=
100;b.Mfilter.frequency.value=1700;b.Tfilter.frequency.value=6500}},Amp4:{drive:function(a){a=Math.pow(a+2,3);for(var c=new Float32Array(22050),d=0;22050>d;d+=1){var e=2*d/22050-1;c[d]=(1+a)*e/(1+a*Math.abs(e))}b.waveshaper.curve=c;b.postWaveShaper.gain.value=0.009},master:"---",tonestack:function(a){b.lowCut.frequency.value=20;b.highCut.frequency.value=2E4;b.Bfilter.frequency.value=100;b.Mfilter.frequency.value=1700;b.Tfilter.frequency.value=6500}},Amp5:{drive:function(a){a=Math.pow(a,3);for(var c=
new Float32Array(22050),d=0;22050>d;d+=1){var e=2*d/22050-1;c[d]=(1+a)*e/(1+a*Math.abs(e))}b.waveshaper.curve=c;b.postWaveShaper.gain.value=0.009},master:"---",tonestack:function(a){b.lowCut.frequency.value=50;b.highCut.frequency.value=15E3;b.Bfilter.frequency.value=100;b.Mfilter.frequency.value=3E3;b.Tfilter.frequency.value=6500}},AmpTest1:{drive:function(a){a/=10;for(var c=new Float32Array(22050),d=0;22050>d;d+=1)c[d]=(0>2*d/22050-1?-1:1)*a;b.waveshaper.curve=c;b.postWaveShaper.gain.value=0.01},
master:"---"},AmpTest2:{drive:function(a){10==a&&(a=9.99);a=2*(a/10)/(1-a/10);for(var c=new Float32Array(22050),d=0;22050>d;d+=1){var e=2*d/22050-1;c[d]=(1+a)*e/(1+a*Math.abs(e))}b.waveshaper.curve=c;b.postWaveShaper.gain.value=0.01},master:"---"},AmpTest3:{drive:function(a){a=1/(1+Math.pow(a,4));for(var c=new Float32Array(22050),d=0;22050>d;d+=1){var e=2*d/22050-1;c[d]=e/(Math.abs(e)+a)}b.waveshaper.curve=c;b.postWaveShaper.gain.value=0.01},master:"---"}},e="Amp1";a.node={};a.node.params={};a.node.params.bass=
function(a){b.Bfilter.gain.value=(a-5)*2*d};a.node.params.mid=function(a){b.Mfilter.gain.value=2*(a-5)};a.node.params.treb=function(a){b.Tfilter.gain.value=2*(a-5)};a.node.params.presence=function(a){b.presence.frequency.value=12E3-400*a};a.node.params.boost=function(a){b.boost.gain.value=a?2:1};a.node.params.master=function(a){b.master.gain.value=a};a.node.params.drive=function(a){f[e].drive(a);debug&&DrawCurve("#edit .ui",b.waveshaper.curve)};a.node.params.type=function(c){f.hasOwnProperty(c)&&
(e=c,f[e].tonestack(),a.node.params.drive(a.pots.drive.val));debug&&DrawCurve("#edit .ui",b.waveshaper.curve)};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};b.input.connect(b.dryGain);b.dryGain.connect(b.lowCut);b.lowCut.connect(b.highCut);b.highCut.connect(b.waveshaper);b.waveshaper.connect(b.postWaveShaper);b.postWaveShaper.connect(b.Bfilter);b.Bfilter.connect(b.Mfilter);b.Mfilter.connect(b.Tfilter);b.Tfilter.connect(b.presence);
b.presence.connect(b.boost);b.boost.connect(b.master);b.master.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);setCustomVals(a.node,a);return a}
function createFilter(a){var c={input:["LeftMiddle"],output:["RightMiddle"],"class":"filter",deletable:!0,connections:[],position:{top:40,left:250},pots:{frequency:{name:"Frequency",id:"frequency",tab:0,val:500,min:20,max:2E4,step:1},q:{name:"Q",id:"q",tab:0,val:1,min:0,max:30,step:1},volume:{name:"Volume",id:"volume",tab:0,val:1,min:0,max:1,step:0.01}},selects:{type:{name:"Type",id:"type",options:[{id:"0",name:"LOWPASS"},{id:"1",name:"HIGHPASS"},{id:"2",name:"BANDPASS"},{id:"3",name:"LOWSHELF"},
{id:"4",name:"HIGHSHELF"},{id:"5",name:"PEAKING"},{id:"6",name:"NOTCH"},{id:"7",name:"ALLPASS"}],selected:0,tab:0}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.filter=context.createBiquadFilter();b.gain=context.createGain();b.bypass=context.createGain();b.input=context.createGain();b.output=context.createGain();b.dryGain=context.createGain();b.wetGain=context.createGain();b.bypass.gain.value=
0;var d=[b.filter.LOWPASS,b.filter.HIGHPASS,b.filter.BANDPASS,b.filter.LOWSHELF,b.filter.HIGHSHELF,b.filter.PEAKING,b.filter.NOTCH,b.filter.ALLPASS];a.node={};a.node.params={};a.node.params.volume=function(a){b.gain.gain.value=a};a.node.params.frequency=function(a){b.filter.frequency.value=a};a.node.params.q=function(a){b.filter.Q.value=a};a.node.params.type=function(a){b.filter.type=d[a]};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=
1)};setCustomVals(a.node,a);b.input.connect(b.dryGain);b.dryGain.connect(b.filter);b.filter.connect(b.gain);b.gain.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);return a}
function createDelay(a){var c={input:["LeftMiddle"],output:["RightMiddle"],"class":"delay",deletable:!0,connections:[],position:{top:65,left:165},pots:{time:{name:"Time",id:"time",tab:0,val:190,min:1,max:1E3},mix:{name:"Mix",id:"mix",tab:0,val:20,min:0,max:100},feedback:{name:"Feedback",id:"feedback",tab:0,val:60,min:0,max:100}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.delayR=context.createDelay();
b.input=context.createGain();b.output=context.createGain();b.dryGain=context.createGain();b.wetGain=context.createGain();b.mixInDry=context.createGain();b.mixInWet=context.createGain();b.bypass=context.createGain();b.interGain=context.createGain();b.splitter=context.createChannelSplitter(2);b.merger=context.createChannelMerger(2);b.delayL=context.createDelay();b.feedbackGain=context.createGain();b.mixInWet.gain.value=0;b.bypass.gain.value=0;b.delayL.delayTime.value=1;a.node={};a.node.params={};a.node.params.time=
function(a){b.delayL.delayTime.value=a/1E3};a.node.params.mix=function(a){var c=a/100;a=Math.cos(0.5*c*Math.PI);c=Math.cos(0.5*(1-c)*Math.PI);b.mixInDry.gain.value=a;b.mixInWet.gain.value=c};a.node.params.feedback=function(a){b.feedbackGain.gain.value=a/100};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};b.input.connect(b.dryGain);b.dryGain.connect(b.mixInDry);b.dryGain.connect(b.mixInWet);b.mixInDry.connect(b.wetGain);
b.mixInWet.connect(b.delayL);b.delayL.connect(b.feedbackGain);b.feedbackGain.connect(b.mixInWet);b.delayL.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);setCustomVals(a.node,a);return a}
function createCabinet(a){var c={input:["LeftMiddle"],output:["RightMiddle"],"class":"cabinet",deletable:!0,connections:[],position:{top:80,left:180},tabs:["General"],pots:{volume:{name:"Volume",id:"volume",tab:0,val:1,min:0,max:1,step:0.01},room:{name:"Room",id:"room",tab:0,val:0,min:0,max:100,step:1}},selects:{type:{name:"Type",id:"type",options:{},selected:"Guitar1",tab:0}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}},defaultscabs:{Guitar1:{id:"Guitar1",name:"Vintage"},Guitar2:{id:"Guitar2",
name:"Modern"}}};"undefined"!==typeof a&&(a=merge_options(c,a));a.node={};a.merger=function(a,b){return merge_options(angular.copy(a),angular.copy(b))};a.selects.type.options=a.merger(c.defaultscabs,angular.element("#PresetCtrl").scope().cabslist);Nodes[a.id]={};var b=Nodes[a.id];b.gain=context.createGain();b.convolver=context.createConvolver();b.room=context.createConvolver();b.bypass=context.createGain();b.input=context.createGain();b.output=context.createGain();b.dryGain=context.createGain();b.wetGain=
context.createGain();b.mixInDry=context.createGain();b.mixInWet=context.createGain();b.volume=context.createGain();b.mixInWet.gain.value=0;b.bypass.gain.value=0;b.gain.gain.value=0.6;b.convolver.normalize=!1;if(cabsRoom.length)b.room.buffer=cabsRoom[0];else{var d=new XMLHttpRequest;d.open("GET","audio/IRs/Block Inside.wav",!0);d.responseType="arraybuffer";d.onload=function(){context.decodeAudioData(d.response,function(a){cabsRoom.push(a);b.room.buffer=a})};d.send()}b.input.connect(b.dryGain);b.dryGain.connect(b.gain);
b.gain.connect(b.convolver);b.convolver.connect(b.mixInDry);b.convolver.connect(b.mixInWet);b.mixInDry.connect(b.wetGain);b.mixInWet.connect(b.room);b.room.connect(b.wetGain);b.wetGain.connect(b.volume);b.volume.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);a.node.params={};a.node.params.volume=function(a){b.volume.gain.value=a};a.node.params.pan=function(a){};a.node.params.type=function(c){a.selects.type.options.hasOwnProperty(c)?cabBuffers.hasOwnProperty(c)?b.convolver.buffer=
cabBuffers[c]:loadCabIR(c,a.selects.type.options[c].file,function(){b.convolver.buffer=cabBuffers[c]}):debug&&console.log("error cab unavailable")};a.node.params.room=function(a){var c=a/100;a=Math.cos(0.5*c*Math.PI);c=Math.cos(0.5*(1-c)*Math.PI);b.mixInDry.gain.value=a;b.mixInWet.gain.value=c};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};setCustomVals(a.node,a);return a}
function createGate(a){var c={input:["LeftMiddle"],output:["RightMiddle"],"class":"gate",deletable:!0,connections:[],position:{top:90,left:190},pots:{threshold:{name:"Threshold",id:"threshold",tab:0,val:-22,min:-90,max:-10,step:1},release:{name:"Release",id:"release",tab:0,val:0.25,min:0,max:1,step:0.01}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.gain=context.createGain();b.bypass=context.createGain();
b.input=context.createGain();b.output=context.createGain();b.dryGain=context.createGain();b.wetGain=context.createGain();b.comp=context.createDynamicsCompressor();b.gate=context.createGain();b.bypass.gain.value=0;b.comp.threshold.value=-70;b.comp.knee.value=0;b.comp.ratio.value=2;b.input.connect(b.dryGain);b.dryGain.connect(b.comp);b.comp.connect(b.gate);b.gate.connect(b.gain);b.gain.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);setInterval(function(){1<=
Math.abs(b.comp.reduction.value)?b.gate.gain.value=1:0.001>=Math.abs(b.comp.reduction.value)?b.gate.gain.value=0:b.gate.gain.value=Math.abs(b.comp.reduction.value)},10);a.node={};a.node.params={};a.node.params.gain=function(a){b.gain.gain.value=a};a.node.params.pan=function(a){a=(a+1)/2;Math.cos(0.5*a*Math.PI);Math.cos(0.5*(1-a)*Math.PI)};a.node.params.threshold=function(a){b.comp.threshold.value=a};a.node.params.release=function(a){b.comp.release.value=a};a.node.params.bypass=function(a){a?(b.bypass.gain.value=
1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};setCustomVals(a.node,a);return a}
function createWah(a){var c={input:["LeftMiddle"],output:["RightMiddle"],deletable:!0,"class":"wah",connections:[],position:{top:100,left:200},pots:{freq:{name:"Frequency",id:"freq",tab:0,midi:!0,val:600,min:320,max:2500,step:1},reso:{name:"Resonance",id:"reso",tab:0,val:4,min:2,max:7,step:0.01}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}},selects:{}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.input=context.createGain();b.output=context.createGain();
b.dryGain=context.createGain();b.wetGain=context.createGain();b.bypass=context.createGain();b.bypass.gain.value=0;b.peak=context.createBiquadFilter();b.peak.type="peaking";b.peak.Q.value=3;b.peak.gain=20;b.low=context.createBiquadFilter();b.low.type="bandpass";b.low.Q.value=2;a.node={};a.node.params={};a.node.params.freq=function(a){b.peak.frequency.value=a;b.low.frequency.value=a};a.node.params.reso=function(a){b.peak.Q.value=a;b.low.Q.value=a};a.node.params.bypass=function(a){a?(b.bypass.gain.value=
1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};b.input.connect(b.dryGain);b.dryGain.connect(b.low);b.low.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);setCustomVals(a.node,a);return a}
function createGraphicEQ(a){var c={input:["LeftMiddle"],output:["RightMiddle"],"class":"graphiceq",deletable:!0,connections:[],position:{top:110,left:210},pots:{gain1:{name:"63",id:"gain1",tab:0,val:0,min:-40,max:40,step:1},gain2:{name:"125",id:"gain2",tab:0,val:0,min:-40,max:40,step:1},gain3:{name:"250",id:"gain3",tab:0,val:0,min:-40,max:40,step:1},gain4:{name:"500",id:"gain4",tab:0,val:0,min:-40,max:40,step:1},gain5:{name:"1K",id:"gain5",tab:0,val:0,min:-40,max:40,step:1},gain6:{name:"2K",id:"gain6",
tab:0,val:0,min:-40,max:40,step:1},gain7:{name:"4K",id:"gain7",tab:0,val:0,min:-40,max:40,step:1},gain8:{name:"8K",id:"gain8",tab:0,val:0,min:-40,max:40,step:1},volume:{name:"Volume",id:"volume",tab:0,val:0.8,min:0,max:1,step:0.01}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.gain=context.createGain();b.bypass=context.createGain();b.input=context.createGain();b.output=context.createGain();b.dryGain=
context.createGain();b.wetGain=context.createGain();b.gain1=context.createBiquadFilter();b.gain2=context.createBiquadFilter();b.gain3=context.createBiquadFilter();b.gain4=context.createBiquadFilter();b.gain5=context.createBiquadFilter();b.gain6=context.createBiquadFilter();b.gain7=context.createBiquadFilter();b.gain8=context.createBiquadFilter();b.pan=context.createPanner();b.pan.panningModel="equalpower";b.bypass.gain.value=0;b.gain1.type="peaking";b.gain1.frequency.value=63;b.gain2.type="peaking";
b.gain2.frequency.value=125;b.gain3.type="peaking";b.gain3.frequency.value=250;b.gain4.type="peaking";b.gain4.frequency.value=500;b.gain5.type="peaking";b.gain5.frequency.value=1E3;b.gain6.type="peaking";b.gain6.frequency.value=2E3;b.gain7.type="peaking";b.gain7.frequency.value=4E3;b.gain8.type="peaking";b.gain8.frequency.value=8E3;b.input.connect(b.dryGain);b.dryGain.connect(b.gain);b.gain.connect(b.gain1);b.gain1.connect(b.gain2);b.gain2.connect(b.gain3);b.gain3.connect(b.gain4);b.gain4.connect(b.gain5);
b.gain5.connect(b.gain6);b.gain6.connect(b.gain7);b.gain7.connect(b.gain8);b.gain8.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);a.node={};a.node.params={};a.node.params.volume=function(a){b.gain.gain.value=a};a.node.params.gain1=function(a){b.gain1.gain.value=a};a.node.params.gain2=function(a){b.gain2.gain.value=a};a.node.params.gain3=function(a){b.gain3.gain.value=a};a.node.params.gain4=function(a){b.gain4.gain.value=a};a.node.params.gain5=function(a){b.gain5.gain.value=
a};a.node.params.gain6=function(a){b.gain6.gain.value=a};a.node.params.gain7=function(a){b.gain7.gain.value=a};a.node.params.gain8=function(a){b.gain8.gain.value=a};a.node.params.pan=function(a){a=(a+1)/2;Math.cos(0.5*a*Math.PI);Math.cos(0.5*(1-a)*Math.PI)};a.node.params.bypass=function(a){a?(b.bypass.gain.value=1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};setCustomVals(a.node,a);return a}
function createPitch(a){var c={input:["LeftMiddle"],output:["RightMiddle"],"class":"pitch",deletable:!0,connections:[],position:{top:120,left:220},pots:{gain:{name:"Gain",id:"gain",tab:0,midi:!0,val:1,min:0,max:1,step:0.01},pitch:{name:"Pitch",id:"pitch",tab:0,val:0,min:0,max:100,step:1,midi:!0}},selects:{type:{name:"Type",id:"type",options:{whammy:{id:"whammy",name:"Whammy"}},selected:"whammy",tab:0},mode:{name:"Mode",id:"mode",options:{"1UP":{id:"1UP",name:"1 Octave UP"},"1DOWN":{id:"1DOWN",name:"1 Octave Down"}},
selected:"1UP",tab:0}},switchers:{bypass:{name:"Bypass",id:"bypass",tab:0,midi:!0,val:!1}}};"undefined"!==typeof a&&(a=merge_options(c,a));Nodes[a.id]={};var b=Nodes[a.id];b.gain=context.createGain();b.bypass=context.createGain();b.input=context.createGain();b.output=context.createGain();b.dryGain=context.createGain();b.wetGain=context.createGain();b.pan=context.createPanner();b.bufferFiller=context.createScriptProcessor(1024);b.bypass.gain.value=0;b.lp=context.createBiquadFilter();b.lp.type="lowpass";
b.lp.frequency.value=1E4;var d=1,f=2,e=1,h=new Pitchshift(1024,context.sampleRate,"FFT");b.input.connect(b.dryGain);b.dryGain.connect(b.gain);b.gain.connect(b.bufferFiller);b.bufferFiller.connect(b.lp);b.lp.connect(b.wetGain);b.wetGain.connect(b.output);b.input.connect(b.bypass);b.bypass.connect(b.output);a.node={};a.node.params={};a.node.params.gain=function(a){b.gain.gain.value=a};a.node.params.pan=function(a){a=(a+1)/2;Math.cos(0.5*a*Math.PI);Math.cos(0.5*(1-a)*Math.PI)};a.node.params.pitch=function(a){e=
a/100*(f-d)+d;b.bufferFiller.onaudioprocess=function(a){var b=[];b[0]=a.outputBuffer.getChannelData(0);var c=[];c[0]=a.outputBuffer.getChannelData(1);var d=[];d[0]=a.inputBuffer.getChannelData(0);a=d[0];h.process(e,a.length,4,a);b=b[0];c=c[0];for(i=0;i<b.length;++i)b[i]=h.outdata[i],c[i]=h.outdata[i]}};a.node.params.type=function(a){};a.node.params.mode=function(b){switch(b){case "1UP":d=1;f=2;break;case "1DOWN":d=1,f=0.5}a.node.params.pitch(a.pots.pitch.val)};a.node.params.bypass=function(a){a?(b.bypass.gain.value=
1,b.dryGain.gain.value=0):(b.bypass.gain.value=0,b.dryGain.gain.value=1)};setCustomVals(a.node,a);return a}function merge_options(a,c){for(var b in c)try{a[b]=c[b].constructor==Object?merge_options(a[b],c[b]):c[b]}catch(d){a[b]=c[b]}return a}
function setCustomVals(a,c){if("undefined"!==typeof c){for(var b in c.pots)if(c.pots.hasOwnProperty(b)&&a.params[b])a.params[b](c.pots[b].val);for(b in c.switchers)if(c.switchers.hasOwnProperty(b)&&a.params[b])a.params[b](c.switchers[b].val);for(b in c.selects)if(c.selects.hasOwnProperty(b)&&a.params[b])a.params[b](c.selects[b].selected)}}function convertToMono(a){var c=context.createChannelSplitter(2),b=context.createChannelMerger(2);a.connect(c);c.connect(b,0,0);c.connect(b,0,1);return b}
function levelView(a,c){var b=context.createAnalyser();b.fftSize=64;a.connect(b);var d=new Uint8Array(64),f=document.querySelector(c),e=f.getContext("2d"),h=f.height,l=f.width;e.fillStyle="#0f0";var m=function(){var a=null,c=null;b.getByteFrequencyData(d);for(c=0;c<d.length;c++)a+=d[c];c=a/d.length;a=-1*c;e.clearRect(0,0,l,h);e.fillRect(0,h,l,a);FrameID=window.webkitRequestAnimationFrame(m)};return m}function Pitchshift(a,c,b){arguments.length&&this.getready(a,c,b)}
Pitchshift.prototype.getready=function(a,c,b){function d(a,b){for(var c=Math.floor(a),d=[],m=0;m<c;m++)d[m]=b;return d}this.fftFrameSize_=a;this.sampleRate_=c;this.hannWindow_=[];this.gRover_=!1;this.algo=b||"FFT";this.MAX_FRAME_LENGTH=8192;this.gInFIFO=d(this.MAX_FRAME_LENGTH,0);this.gOutFIFO=d(this.MAX_FRAME_LENGTH,0);this.gLastPhase=d(this.MAX_FRAME_LENGTH/2+1,0);this.gSumPhase=d(this.MAX_FRAME_LENGTH/2+1,0);this.gOutputAccum=d(2*this.MAX_FRAME_LENGTH,0);this.gAnaFreq=d(this.MAX_FRAME_LENGTH,0);
this.gAnaMagn=d(this.MAX_FRAME_LENGTH,0);this.gSynFreq=d(this.MAX_FRAME_LENGTH,0);this.gSynMagn=d(this.MAX_FRAME_LENGTH,0);this.gFFTworksp=d(this.fftFrameSize_,0);this.real_=[];this.imag_=[];this.outdata=[];this.hannWindow_=[];for(k=0;k<a;k++)this.hannWindow_[k]=WindowFunction.Hann(a,k);if("FFT"===this.algo)this.fft=new FFT(this.fftFrameSize_,this.sampleRate_);else if("RFFT"===this.algo)this.fft=new RFFT(this.fftFrameSize_,this.sampleRate_);else throw Error("Invalid DFT algorithm selected "+this.algo);
this.invFFT=new FFT(this.fftFrameSize_,this.sampleRate_)};
Pitchshift.prototype.process=function(a,c,b,d){function f(a,b,c){b=Math.floor(b);for(var d=0;d<b;d++)a[d]=c}var e=this.fftFrameSize_/2,h=this.fftFrameSize_/b,l=this.sampleRate_/this.fftFrameSize_,m=2*Math.PI*h/this.fftFrameSize_,q=this.fftFrameSize_-h,p,g=0,r,n,s;!1===this.gRover_&&(this.gRover_=q);for(p=0;p<c;p++)if(this.gInFIFO[this.gRover_]=d[p],this.outdata[p]=this.gOutFIFO[this.gRover_-q],this.gRover_++,this.gRover_>=this.fftFrameSize_){this.gRover_=q;for(g=0;g<this.fftFrameSize_;g++)this.gFFTworksp[g]=
this.gInFIFO[g]*this.hannWindow_[g];this.fft.forward(this.gFFTworksp);for(g=0;g<=e;g++){if("FFT"===this.algo)r=2*Math.sqrt(this.fft.real[g]*this.fft.real[g]+this.fft.imag[g]*this.fft.imag[g]),n=Math.atan2(this.fft.imag[g],this.fft.real[g]);else if("RFFT"===this.algo)n=this.fft.trans[g],s=0==g?0:this.fft.trans[this.fftFrameSize_-g],r=2*Math.sqrt(n*n+s*s),n=Math.atan2(s,n);else throw Error("Invalid DFT algorithm selected "+this.algo);s=n-this.gLastPhase[g];this.gLastPhase[g]=n;s-=g*m;n=s/Math.PI;0<=
n?(n=Math.floor(n),n+=n&1):(n=Math.ceil(n),n-=n&1);s-=Math.PI*n;s=b*s/(2*Math.PI);s=g*l+s*l;this.gAnaMagn[g]=r;this.gAnaFreq[g]=s}f(this.gSynMagn,this.fftFrameSize_,0);f(this.gSynFreq,this.fftFrameSize_,0);for(g=0;g<=e;g++)r=Math.floor(g*a),r<=e&&(this.gSynMagn[r]+=this.gAnaMagn[g],this.gSynFreq[r]=this.gAnaFreq[g]*a);for(g=0;g<=e;g++)r=this.gSynMagn[g],s=this.gSynFreq[g],s-=g*l,s/=l,s=2*Math.PI*s/b,s+=g*m,this.gSumPhase[g]+=s,n=this.gSumPhase[g],this.real_[g]=r*Math.cos(n),this.imag_[g]=r*Math.sin(n);
for(g=e+1;g<this.fftFrameSize_;g++)this.real_[g]=0,this.imag_[g]=0;r=this.invFFT.inverse(this.real_,this.imag_);for(g=0;g<this.fftFrameSize_;g++)this.gOutputAccum[g]+=this.hannWindow_[g]*r[g];for(g=0;g<h;g++)this.gOutFIFO[g]=this.gOutputAccum[g];r=this.gOutputAccum.slice(h,h+this.fftFrameSize_);for(g=0;g<this.fftFrameSize_;g++)this.gOutputAccum[g]=r[g];for(g=0;g<q;g++)this.gInFIFO[g]=this.gInFIFO[g+h]}};
